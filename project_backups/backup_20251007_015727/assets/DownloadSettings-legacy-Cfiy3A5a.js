!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){a(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function a(t,n,o){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,r,l,i=[],s=!0,d=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(i.push(o.value),i.length!==t);s=!0);}catch(e){d=!0,a=e}finally{try{if(!s&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(d)throw a}}return i}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}System.register(["./index-legacy-DbvsbuFI.js","./TextSetting-legacy-Cib3Ex8R.js","./NumberSetting-legacy-Bm02wQ7l.js","./usePersistedValue-legacy-DP4TJtF4.js","./Switch-legacy-DtSfVgi4.js","./SelectSetting-legacy-LW2U6I_s.js","./CategoriesInclusionSetting-legacy-DaF53Et-.js","./EmptyViewAbsoluteCentered-legacy-CZb4FyHT.js","./useAppTitle-legacy-oE1eilGc.js","./Delete-legacy-C2eSwLaM.js","./ListSubheader-legacy-D6CTP6K_.js","./Slider-legacy-Dx30W6c-.js","./SwitchBase-legacy-WgGrSGAu.js","./Select-legacy-SzY7YSW6.js","./ThreeStateCheckboxInput-legacy-vZt-HlJP.js","./Checkbox-legacy-Do2WUkle.js"],function(e,n){"use strict";var l,i,s,d,u,c,h,p,g,f,m,w,b,y,x,v,j,_,C,S,D,T,k,A,L,N,O,P,U,I,F,E,W,V,M,R,z,B,q,G,H;return{setters:[function(e){l=e.u,i=e.j,s=e.H,d=e.o,u=e.p,c=e.by,h=e.Z,p=e.m,g=e.g,f=e.b,m=e.aS,w=e.i,b=e.k,y=e.n,x=e.b7,v=e.S,j=e.q,_=e.B,C=e.bz,S=e.b2,D=e.bA,T=e.C,k=e.I,A=e.bd,L=e.r,N=e.b4,O=e.a,P=e.e,U=e.f,I=e.y},function(e){F=e.T},function(e){E=e.N},function(e){W=e.u,V=e.g},function(e){M=e.S},function(e){R=e.S},function(e){z=e.a},function(e){B=e.E},function(e){q=e.u},function(e){G=e.D},function(e){H=e.L},null,null,null,null,null],execute:function(){var n=function(e){var t=e.downloadAheadLimit,n=l().t,o=!!t,a=r(W("lastDownloadAheadLimit",c.default,t,V),2),f=a[0],m=a[1],w=function(e){m(0===e?f:e),h("downloadAheadLimit",e).catch(function(e){return p(n("global.error.label.failed_to_save_changes"),"error",g(e))})};return i.jsxs(s,{children:[i.jsxs(d,{children:[i.jsx(u,{primary:n("download.settings.download_ahead.label.while_reading")}),i.jsx(M,{edge:"end",checked:o,onChange:function(e){return t=e.target.checked,void w(t?f:0);var t}})]}),i.jsx(E,{settingTitle:n("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:n("download.settings.download_ahead.label.value",{chapters:f,count:f}),value:f,minValue:c.min,maxValue:c.max,defaultValue:c.default,stepSize:c.step,showSlider:!0,dialogDescription:n("download.settings.download_ahead.label.description"),dialogDisclaimer:n("download.settings.download_ahead.label.disclaimer"),valueUnit:n("chapter.title_one"),handleUpdate:w,disabled:!o})]})},Z={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},$=[0,1,2,3,4,5].map(function(e){return[e,Z[e]]}),J=function(e){var t=e.chapterToDelete,n=e.handleChange,o=l().t,a=function(e){return"boolean"==typeof e?Number(e):e}(t);return i.jsx(R,{settingName:o("download.settings.delete_chapters.while_reading.label.title"),value:a,values:$,handleChange:n})},K="default",Q="image/",X=function(e){return e.replace(Q,"")},Y=function(e){return X(e.toLowerCase().trim())===K},ee=function(e,t,n){return n.slice(0,t).some(function(t){return t.mimeType===e})},te=function(e){return null==e||e>=D.min&&e<=D.max},ne=function(e){return e.map(function(e){return o(o({},e),{},{mimeType:X(e.mimeType),target:X(e.target)})})},oe=function(e){return e.filter(function(e){var t=e.mimeType,n=e.target;return!!t&&!!n}).map(function(e){return o(o({},e),{},{mimeType:"".concat(Q).concat(e.mimeType),target:"".concat(Q).concat(e.target)})})},ae=function(e){var n=e.some(function(e){var t=e.mimeType;return Y(t)});return[].concat(t(n?[]:[{mimeType:K,target:"",compressionLevel:null}]),t(e))},re=function(e){var t=e.shouldAutoFocus,n=e.isDefault,o=e.isDuplicate,a=e.label,r=e.value,s=e.onUpdate,d=l().t;return i.jsx(S,{sx:{maxWidth:150},autoFocus:t,label:a,value:r,disabled:n,error:o,helperText:o&&d("global.error.label.invalid_input"),slotProps:{input:{startAdornment:i.jsx(A,{position:"start",children:Q})}},onChange:function(e){return s(e.target.value.trim())}})},le=function(e){var t=e.shouldAutoFocusMimeTypeTextField,n=e.conversion,o=n.mimeType,a=n.target,r=n.compressionLevel,s=e.setFocusMimeTypeTextField,d=e.onChange,u=e.isDuplicate,c=l().t,h=te(r),p=Y(o)&&!u,g=p&&!a&&null==r;return i.jsxs(v,{sx:{gap:1,flexDirection:"row",flexWrap:"nowrap",alignItems:"center",pt:1},children:[i.jsxs(v,{sx:{gap:1,flexDirection:"row",alignItems:"baseline",flexWrap:"wrap"},children:[i.jsx(re,{shouldAutoFocus:t,isDefault:p,isDuplicate:u,label:c("download.settings.conversion.mime_type"),value:o,onUpdate:function(e){s(!0),d({mimeType:e,target:a,compressionLevel:r})}}),i.jsx(C,{sx:{mx:1},children:"→"}),i.jsx(re,{shouldAutoFocus:!1,isDefault:!1,isDuplicate:!1,label:c("download.settings.conversion.target"),value:a,onUpdate:function(e){return d({mimeType:o,target:e,compressionLevel:r})}}),i.jsx(S,{label:c("download.settings.conversion.compression_level"),value:null!=r?r:"",type:"number",error:!h,helperText:h?"":c("global.error.label.invalid_input"),slotProps:{input:{inputProps:D}},onChange:function(e){d({mimeType:o,target:a,compressionLevel:e.target.value?Number(e.target.value):void 0})}})]}),i.jsx(T,{disabled:g,title:c("chapter.action.download.delete.label.action"),children:i.jsx(k,{disabled:g,onClick:function(){s(!1),d(null)},children:i.jsx(G,{})})})]})},ie=function(e){var n=e.conversions,o=e.updateSetting,a=l().t,s=r(f.useState(!1),2),d=s[0],c=s[1],h=r(f.useState(ne(ae(n))),2),p=h[0],g=h[1],C=r(f.useState(-1),2),S=C[0],D=C[1],T=function(e){return e.some(function(t,n){var o=t.mimeType,a=t.compressionLevel;return!te(a)||ee(o,n,e)})}(p),k=function(e,t){return e.length!==t.length||e.some(function(e,n){var o=e.mimeType,a=e.target,r=e.compressionLevel,l=t[n];return X(o)!==l.mimeType||X(a)!==l.target||r!==l.compressionLevel})}(ne(ae(n)),p),A=function(){g(ne(ae(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n))),c(!1)},L=function(){A(n)};return i.jsxs(i.Fragment,{children:[i.jsx(m,{disabled:!1,onClick:function(){return c(!0)},children:i.jsx(u,{primary:a("download.settings.conversion.title"),secondary:n.map(function(e){return"".concat(e.mimeType," → ").concat(e.target)}).join("; "),secondaryTypographyProps:{style:{display:"flex",flexDirection:"column"}}})}),i.jsxs(w,{open:d,onClose:L,children:[i.jsx(b,{children:a("download.settings.conversion.title")}),i.jsxs(y,{children:[i.jsx(x,{sx:{mb:2,whiteSpace:"pre-line"},children:a("download.settings.conversion.description",{value:"none"})}),i.jsx(v,{sx:{flexDirection:"column",gap:3},children:p.map(function(e,n){var o=e.mimeType,a=ee(o,n,p),r=n===S;return i.jsx(le,{conversion:e,isDuplicate:a,setFocusMimeTypeTextField:function(e){return D(e?n:-1)},shouldAutoFocusMimeTypeTextField:r,onChange:function(e){g(function(o){return ae(o.toSpliced.apply(o,[n,1].concat(t(e?[e]:[]))))})}},"".concat(o,"-").concat(n))})})]}),i.jsx(j,{children:i.jsxs(v,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[i.jsx(_,{variant:"outlined",onClick:function(){g(function(e){return[].concat(t(e),[{mimeType:"",target:"",compressionLevel:null}])})},children:a("global.button.add")}),i.jsxs(v,{direction:"row",children:[i.jsx(_,{onClick:L,children:a("global.button.cancel")}),i.jsx(_,{disabled:T||!k,onClick:function(){return o(oe(p)).then(function(){return A(oe(p))})},children:a("global.button.ok")})]})]})})]})]})};e("DownloadSettings",function(){var e,t,o,c=l().t;q(c("download.title.download"));var h=L.useGetCategories(N),f=L.useGetServerSettings({notifyOnNetworkStatusChange:!0}),m=r(L.useUpdateServerSettings(),1)[0],w=O(),b=w.settings,y=w.loading,x=w.request,v=x.error,j=x.refetch;if(f.loading||y||h.loading)return i.jsx(P,{});var _=null!==(e=null!==(t=f.error)&&void 0!==t?t:v)&&void 0!==e?e:h.error;if(_)return i.jsx(B,{message:c("global.error.label.failed_to_load_data"),messageExtra:g(_),retry:function(){f.error&&f.refetch().catch(U()),v&&j().catch(U()),h.error&&h.refetch().catch(U())}});var C,S={downloadAsCbz:(C=f.data.settings).downloadAsCbz,downloadsPath:C.downloadsPath,autoDownloadNewChapters:C.autoDownloadNewChapters,autoDownloadNewChaptersLimit:C.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:C.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:C.autoDownloadIgnoreReUploads,downloadConversions:C.downloadConversions},D=function(e,t){var n=m({variables:{input:{settings:a({},e,t)}}});return n.catch(function(e){return p(c("global.error.label.failed_to_save_changes"),"error",g(e))}),n},T=I(function(e){return p(c("global.error.label.failed_to_save_changes"),"error",g(e))});return i.jsxs(s,{sx:{pt:0},children:[i.jsx(F,{settingName:c("download.settings.download_path.label.title"),dialogDescription:c("download.settings.download_path.label.description"),value:null==S?void 0:S.downloadsPath,settingDescription:null!=S&&S.downloadsPath.length?S.downloadsPath:c("global.label.default"),handleChange:function(e){return D("downloadsPath",e)}}),i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.file_type.label.cbz")}),i.jsx(M,{edge:"end",checked:!(null==S||!S.downloadAsCbz),onChange:function(e){return D("downloadAsCbz",e.target.checked)}})]}),i.jsx(ie,{conversions:null==S?void 0:S.downloadConversions,updateSetting:function(e){return D("downloadConversions",e)}}),i.jsxs(s,{subheader:i.jsx(H,{component:"div",id:"download-settings-auto-delete-downloads",children:c("download.settings.delete_chapters.title")}),children:[i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.delete_chapters.label.manually_marked_as_read")}),i.jsx(M,{edge:"end",checked:b.deleteChaptersManuallyMarkedRead,onChange:function(e){return T("deleteChaptersManuallyMarkedRead",e.target.checked)}})]}),i.jsx(J,{chapterToDelete:b.deleteChaptersWhileReading,handleChange:function(e){return T("deleteChaptersWhileReading",e)}}),i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),i.jsx(M,{edge:"end",checked:b.deleteChaptersWithBookmark,onChange:function(e){return T("deleteChaptersWithBookmark",e.target.checked)}})]})]}),i.jsxs(s,{subheader:i.jsx(H,{component:"div",id:"download-settings-auto-download",children:c("download.settings.auto_download.title")}),children:[i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.auto_download.label.new_chapters")}),i.jsx(M,{edge:"end",checked:!(null==S||!S.autoDownloadNewChapters),onChange:function(e){return D("autoDownloadNewChapters",e.target.checked)}})]}),i.jsx(E,{disabled:!(null!=S&&S.autoDownloadNewChapters),settingTitle:c("download.settings.auto_download.download_limit.label.title"),dialogDescription:c("download.settings.auto_download.download_limit.label.description"),value:null!==(o=null==S?void 0:S.autoDownloadNewChaptersLimit)&&void 0!==o?o:0,settingValue:S.autoDownloadNewChaptersLimit?c("download.settings.download_ahead.label.value",{chapters:S.autoDownloadNewChaptersLimit,count:S.autoDownloadNewChaptersLimit}):c("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:c("chapter.title_one"),handleUpdate:function(e){return D("autoDownloadNewChaptersLimit",e)}}),i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.auto_download.label.ignore_with_unread_chapters")}),i.jsx(M,{edge:"end",checked:!(null==S||!S.excludeEntryWithUnreadChapters),onChange:function(e){return D("excludeEntryWithUnreadChapters",e.target.checked)},disabled:!(null!=S&&S.autoDownloadNewChapters)})]}),i.jsxs(d,{children:[i.jsx(u,{primary:c("download.settings.auto_download.label.ignore_re_uploads")}),i.jsx(M,{edge:"end",checked:!(null==S||!S.autoDownloadIgnoreReUploads),onChange:function(e){return D("autoDownloadIgnoreReUploads",e.target.checked)},disabled:!(null!=S&&S.autoDownloadNewChapters)})]}),i.jsx(z,{categories:h.data.categories.nodes,includeField:"includeInDownload",dialogText:c("download.settings.auto_download.categories.label.include_in_download")})]}),i.jsx(s,{subheader:i.jsx(H,{component:"div",id:"download-settings-download-ahead",children:c("download.settings.download_ahead.title")}),children:i.jsx(n,{downloadAheadLimit:b.downloadAheadLimit})})]})})}}})}();
