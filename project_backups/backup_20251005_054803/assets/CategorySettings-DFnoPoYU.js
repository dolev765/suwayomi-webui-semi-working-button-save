var I=Object.freeze,M=Object.defineProperty;var k=(o,l)=>I(M(o,"raw",{value:I(l||o.slice())}));import{u as v,j as e,z as C,T as q,S as U,C as A,I as F,r as h,b as g,i as P,k as W,n as z,b2 as K,q as V,B as O,b3 as Y,m as L,g as y,b4 as J,e as Q,f as X,b5 as Z}from"./index-B3NSCdsi.js";import{A as $}from"./Add-D_hggg0n.js";import{D as ee,a as te,b as oe,c as re,S as ae,v as se,d as ne,e as ie}from"./DragHandle-THbwkITu.js";import{D as le,F as de}from"./StyledFab-DBXPzirh.js";import{E as ce}from"./EmptyViewAbsoluteCentered-DBqm8ISe.js";import{E as ge}from"./Edit-r-SDr3pE.js";import{D as ue}from"./Delete-CRgzWPPc.js";import{L as me}from"./ListCardContent-BS1h8d31.js";import{C as xe}from"./Card-CmqD9oyv.js";import{u as he}from"./useAppTitle-CiigzFb7.js";import{F as pe,C as fe}from"./Checkbox-D6x2ifd_.js";import"./SwitchBase-CZLmNsA7.js";const w=({category:o,onEdit:l})=>{const{t:s}=v(),r=()=>{h.deleteCategory(o.id)};return e.jsx(C,{sx:{p:1,pb:0},children:e.jsx(xe,{children:e.jsxs(me,{sx:{gap:2},children:[e.jsx(ee,{}),e.jsx(q,{sx:{flexGrow:1},variant:"h6",component:"h2",children:o.name}),e.jsxs(U,{sx:{flexDirection:"row"},children:[e.jsx(A,{title:s("global.button.edit"),children:e.jsx(F,{component:C,onClick:l,children:e.jsx(ge,{})})}),e.jsx(A,{title:s("chapter.action.download.delete.label.action"),children:e.jsx(F,{component:C,onClick:r,children:e.jsx(ue,{})})})]})]})})})},_=-1;var G;const Ce=({category:o,onClose:l})=>{const s=!!o,{t:r}=v(),[n,b]=g.useState(o==null?void 0:o.name),[u,j]=g.useState(!!(o!=null&&o.default)),m=n!==void 0&&!n.trim().length,p=n!==void 0&&!m,D=()=>{if(Y(n),l(),s){h.updateCategory(o.id,{name:n,default:u}).response.catch(i=>L(r("global.error.label.failed_to_save_changes"),"error",y(i)));return}h.createCategory({name:n,default:u}).response.catch(i=>L(r("category.error.label.create_failure"),"error",y(i)))};return e.jsxs(P,{open:!0,onClose:l,children:[e.jsx(W,{id:"form-dialog-title",children:r(s?"category.dialog.title.edit_category_one":"category.dialog.title.new_category")}),e.jsxs(z,{children:[e.jsx(K,{autoFocus:!0,margin:"dense",id:"name",label:r("category.label.category_name"),type:"text",fullWidth:!0,value:n,onChange:i=>b(i.target.value.trim()),error:m,helperText:m?r(G||(G=k(["global.error.label.invalid_input"]))):void 0}),e.jsx(pe,{control:e.jsx(fe,{checked:u,onChange:i=>j(i.target.checked)}),label:r("category.label.use_as_default_category")})]}),e.jsxs(V,{children:[e.jsx(O,{onClick:l,color:"primary",children:r("global.button.cancel")}),e.jsx(O,{onClick:D,color:"primary",disabled:!p,children:r("global.button.submit")})]})]})};function Oe(){const{t:o}=v(),l=te.useSensorsForDevice();he(o("category.dialog.title.edit_category_other"));const{data:s,loading:r,error:n,refetch:b}=h.useGetCategories(J,{notifyOnNetworkStatusChange:!0}),[u,{reset:j}]=h.useReorderCategory(),[m,p]=g.useState(_),[D,i]=g.useState(!1),[x,f]=g.useState(null),d=g.useMemo(()=>{var a;const t=[...(a=s==null?void 0:s.categories.nodes)!=null?a:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),R=(t,a,c)=>{const E=t[a];u({variables:{input:{id:E.id,position:c+1}}}).catch(()=>j())},B=t=>{const{active:a,over:c}=t;if(f(null),!c||a.id===c.id)return;const E=d.findIndex(S=>S.id===a.id),H=d.findIndex(S=>S.id===c.id);R(d,E,H)},T=t=>{p(t!=null?t:_),i(!0)},N=()=>{p(_),i(!1)};return r?e.jsx(Q,{}):n?e.jsx(ce,{message:o("category.error.label.request_failure"),messageExtra:y(n),retry:()=>b().catch(X())}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{sensors:l,collisionDetection:re,onDragStart:t=>{var a;return f((a=d.find(c=>c.id===t.active.id))!=null?a:null)},onDragEnd:B,onDragCancel:()=>f(null),onDragAbort:()=>f(null),children:e.jsxs(C,{sx:{paddingBottom:le},children:[e.jsx(ae,{items:d,strategy:se,children:d.map((t,a)=>e.jsx(ne,{id:t.id,isDragging:t.id===(x==null?void 0:x.id),children:e.jsx(w,{category:t,onEdit:()=>T(a)})},t.id))}),e.jsx(ie,{isActive:!!x,children:e.jsx(w,{category:x,onEdit:Z})})]})}),e.jsx(de,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:t=>t.spacing(2),right:t=>t.spacing(2)},onClick:()=>T(),children:e.jsx($,{})}),D&&e.jsx(Ce,{category:d[m],onClose:N})]})}export{Oe as CategorySettings};
