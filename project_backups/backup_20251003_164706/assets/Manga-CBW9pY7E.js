import{b as _,c as Y,j as i,u as A,a6 as F,L as it,i as Pt,k as ie,n as oe,q as se,S as k,B as rt,a7 as Wt,a8 as ct,a9 as ae,C as $,I as E,aa as Nt,ab as Gt,ac as le,E as ce,O as St,M as Ut,r as U,ad as ue,e as qt,g as ot,f as de,a4 as z,T as st,z as Qt,ae as Kt,m as at,af as he,ag as ge,ah as fe,ai as me,aj as pe,ak as be,al as xe,am as ve,an as R,ao as Ce,ap as _e,aq as Mt,d as je,V as we,ar as ye,A as N,as as Yt,at as Se,a2 as G,au as Me,av as bt,aw as ke,ax as Le,ay as Ie,az as Te,a as Be,aA as xt,Y as Re,aB as De,aC as Ee,aD as Ae,aE as kt,aF as Ve,aG as ut,aH as dt,p as ht,aI as $e,aJ as Oe,aK as Fe,aL as He,aM as ze}from"./index-B3NSCdsi.js";import{P as Pe}from"./PlayArrow-DOQGdp59.js";import{S as We,D as Ne}from"./StyledFab-DBXPzirh.js";import{u as Jt,i as Ge,a as Ue,f as qe,b as Qe,c as Ke,F as Ye,C as Lt,d as Je}from"./useManageMangaLibraryState-BUwOAIwu.js";import{E as nt}from"./EmptyViewAbsoluteCentered-DBqm8ISe.js";import{F as Xe}from"./FilterList-CYp6tALP.js";import{D as Ze}from"./Download-CPjWlyL3.js";import{D as tr}from"./DoneAll-95vjaRsw.js";import{S as er,R as It}from"./SortRadioInput-DwArgo8A.js";import{D as rr,T as gt}from"./ThreeStateCheckboxInput-tKUmVeuL.js";import{O as nr,S as ir,a as or}from"./SelectionFAB-CaKcgUoQ.js";import{C as Xt}from"./CheckboxInput-Dh0Qp3DA.js";import{F as sr}from"./FormGroup-CBmCwp4o.js";import{R as ar}from"./ListPreference-BJcyAgN-.js";import{C as lr,T as cr,S as Tt,L as Bt}from"./ChaptersDownloadActionMenuItems-CcsnGrPF.js";import{C as ur,a as dr,I as hr,b as gr}from"./ChapterListCard-BKt-AMC8.js";import{V as fr}from"./VirtuosoPersisted-S1uprXuO.js";import{F as mr}from"./Favorite-Bd4PFCwq.js";import{S as pr}from"./Sync-0GqVgN_I.js";import{T as ft}from"./Trackers-Bgo8y--2.js";import{M as br}from"./Metadata-FLylicix.js";import{S as xr}from"./Sources-BeCW7qIA.js";import{E as vr,a as Cr}from"./ExpandMore-Jy0XmMrp.js";import{L as vt}from"./Link-BvpaqdUk.js";import{C as _r}from"./Chip-BF4pkKVE.js";import{u as jr}from"./useAppTitleAndAction-d39yNVev.js";import"./Checkbox-D6x2ifd_.js";import"./SwitchBase-CZLmNsA7.js";import"./Tabs-DTRAAzXi.js";import"./AvatarSpinner-DZhm5L23.js";import"./Card-CmqD9oyv.js";import"./ListCardContent-BS1h8d31.js";import"./CheckCircle-4LYvLq7E.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-Ggl6ojvp.js";import"./NumberSetting-DZ-XTU9n.js";import"./Slider-CwwfJui_.js";import"./useMobilePicker-D4yHrKRj.js";import"./SelectSetting-DYiz4PGL.js";import"./Select-CbmmqdPd.js";import"./ChapterCardMetadata-BcJ-3HE_.js";import"./Delete-CRgzWPPc.js";import"./index-BrsGsN69.js";import"./Virtuoso.util-B9xnGAMQ.js";import"./use-merged-ref-Box3cAY6.js";import"./useAppTitle-CiigzFb7.js";import"./useAppAction-B9eFgfiP.js";function wr(t){return _.Children.toArray(t).filter(e=>_.isValidElement(e))}const yr=Y(i.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}));function Sr({chapter:t}){const{t:e}=A(),{sourceOrder:r}=t;return i.jsxs(We,{component:it,variant:"extended",color:"primary",to:F.getReaderUrl(t),state:F.getReaderOpenChapterLocationState(t),children:[i.jsx(Pe,{}),e(r===1?"global.button.start":"global.button.resume")]})}const Rt=Y(i.jsx("path",{d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 0c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 7c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m6 5H3v-.99C3.2 16.29 6.3 15 9 15s5.8 1.29 6 2z"}));function Mr({title:t,emptyMessage:e,items:r,getId:n,getLabel:o,isChecked:s,open:a,onClose:l,slotProps:c}){const{t:d}=A(),u=_.useMemo(()=>r.map(n),[r]),g=_.useMemo(()=>r.filter(s).map(n),[r]),{selectedItemIds:h,handleSelection:m,handleSelectAll:f,reset:b}=Jt(r.length,{currentKey:"default",itemIds:u,initialState:{default:g}}),x=()=>{l(),b()},C=_.useCallback(()=>{const v=h.length!==g.length||h.some(w=>!g.includes(w)),T=r.filter(w=>h.includes(n(w)));l(v?T:void 0)},[h]);return i.jsxs(Pt,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:a,onClose:x,children:[i.jsx(ie,{children:t}),i.jsx(oe,{dividers:!0,children:i.jsxs(sr,{children:[r.length===0&&i.jsx("span",{children:e}),r.map(v=>_.createElement(Xt,{...c==null?void 0:c.checkbox,checked:h.includes(n(v)),onChange:(T,w)=>m(n(v),w),label:o(v),key:n(v)}))]})}),i.jsx(se,{children:i.jsx(k,{sx:{width:"100%"},children:i.jsxs(k,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[i.jsx(rt,{onClick:()=>f(!h.length,r.map(n)),children:d(h.length?"global.button.reset":"global.button.select_all")}),i.jsxs(k,{direction:"row",children:[i.jsx(rt,{autoFocus:!0,onClick:x,color:"primary",children:d("global.button.cancel")}),!!r.length&&i.jsx(rt,{onClick:C,color:"primary",children:d("global.button.ok")})]})]})})})]})}const kr=({updateOption:t,scanlators:e,excludedScanlators:r})=>{const{t:n}=A(),o=Wt({variant:"dialog",popupId:"chapter-list-options-scanlator-filter-dialog"});return e.length?i.jsxs(i.Fragment,{children:[i.jsx(Xt,{...ct(o),label:n("global.label.scanlator"),icon:i.jsx(Rt,{}),checkedIcon:i.jsx(Rt,{color:"warning"}),checked:!!r.length}),i.jsx(Mr,{title:n("chapter.option.exclude_scanlators"),open:o.isOpen,onClose:s=>{s&&t("excludedScanlators",s),o.close()},items:e,getId:s=>s,getLabel:s=>s,isChecked:s=>r.includes(s),slotProps:{checkbox:{checkedIcon:i.jsx(rr,{})}}})]}):null},Lr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Ir=({open:t,onClose:e,options:r,updateOption:n,scanlators:o,excludedScanlators:s})=>{const{t:a}=A();return i.jsx(nr,{open:t,onClose:e,minHeight:150,tabs:["filter","sort","display"],tabTitle:l=>a(Lr[l]),tabContent:l=>l==="filter"?i.jsxs(i.Fragment,{children:[i.jsx(gt,{label:a("global.filter.label.unread"),checked:r.unread,onChange:c=>n("unread",c)}),i.jsx(gt,{label:a("global.filter.label.downloaded"),checked:r.downloaded,onChange:c=>n("downloaded",c)}),i.jsx(gt,{label:a("global.filter.label.bookmarked"),checked:r.bookmarked,onChange:c=>n("bookmarked",c)}),i.jsx(kr,{scanlators:o,excludedScanlators:s,updateOption:n})]}):l==="sort"?Object.entries(ae).map(([c,d])=>i.jsx(er,{label:a(d),checked:r.sortBy===c,sortDescending:r.reverse,onClick:()=>c!==r.sortBy?n("sortBy",c):n("reverse",!r.reverse)},c)):l==="display"?i.jsxs(ar,{onChange:()=>n("showChapterNumber",!r.showChapterNumber),value:r.showChapterNumber,children:[i.jsx(It,{label:a("chapter.option.display.label.source_title"),value:!1}),i.jsx(It,{label:a("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Tr=({mangaId:t,options:e,updateOption:r,chapters:n,scanlators:o,excludeScanlators:s})=>{const{t:a}=A(),[l,c]=_.useState(!1),d=Ge(e),u=_.useMemo(()=>n.every(F.isRead),[n]),g=_.useMemo(()=>n.every(F.isDownloaded),[n]);return i.jsxs(i.Fragment,{children:[i.jsx($,{title:a("chapter.action.mark_as_read.add.label.action.all"),disabled:u,children:i.jsx(E,{disabled:u,onClick:()=>F.markAsRead(F.getNonRead(n),!0,t),color:"inherit",children:i.jsx(tr,{})})}),i.jsx(Nt,{variant:"popover",popupId:"chapterlist-download-button",children:h=>i.jsxs(i.Fragment,{children:[i.jsx($,{title:a("global.button.download"),disabled:u,children:i.jsx(E,{disabled:g,...ct(h),color:"inherit",children:i.jsx(Ze,{})})}),h.isOpen&&i.jsx(Gt,{...le(h),children:i.jsx(lr,{mangaIds:[t],closeMenu:h.close})})]})}),i.jsx($,{title:a("chapter.action.filter_and_sort.label"),children:i.jsx(E,{onClick:()=>c(!0),color:"inherit",children:i.jsx(Xe,{color:d?"warning":void 0})})}),i.jsx(Ir,{open:l,onClose:()=>c(!1),options:e,updateOption:r,scanlators:o,excludedScanlators:s})]})},Br=z(k,{shouldForwardProp:Kt(["scrollbarWidth"])})(({theme:t,scrollbarWidth:e})=>({padding:t.spacing(1),paddingRight:"calc(".concat(e,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Rr=z(fr,{shouldForwardProp:Kt(["topOffset"])})(({theme:t,topOffset:e})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(e,"px)"),margin:0}})),Dr=({selectedChapters:t,firstUnreadChapter:e,onFABMenuClose:r})=>t.length?i.jsx(or,{selectedItemsCount:t.length,title:"chapter.title_one",children:n=>i.jsx(dr,{selectedChapters:t,onClose:()=>{r==null||r(),n()}})}):e?i.jsx(Sr,{chapter:e}):null,Er=({manga:t,isRefreshing:e})=>{const{t:r}=A(),{appBarHeight:n}=ce(),o=St.useIsBelowWidth("md"),[s,a]=_.useState(50),[l,c]=_.useState(null);Ut(l,_.useCallback(()=>{var M;return a((M=l==null?void 0:l.offsetHeight)!=null?M:0)},[l]));const d=St.useGetScrollbarSize("width"),u=Ue(t),g=Qe(t,M=>at(r("global.error.label.failed_to_save_changes"),"error",ot(M))),{data:h,loading:m,error:f,refetch:b}=U.useGetMangaChapters(ue,t.id,{notifyOnNetworkStatusChange:!0}),x=_.useMemo(()=>{var M;return(M=h==null?void 0:h.chapters.nodes)!=null?M:[]},[h==null?void 0:h.chapters.nodes]),C=_.useMemo(()=>qe(x,u),[x,u]),v=_.useMemo(()=>F.getIds(C),[C]),T=_.useMemo(()=>F.getMissingCount(C),[C]),w=x.length===0,B=!w&&C.length===0,{areNoItemsSelected:j,areAllItemsSelected:y,selectedItemIds:S,handleSelectAll:I,handleSelection:L,clearSelection:J}=Jt(v.length,{itemIds:v,currentKey:"default"}),X=_.useCallback((M,P,Z)=>L(M,P,{selectRange:Z}),[L]);return m||w&&e?i.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:i.jsx(qt,{})}):f?i.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:i.jsx(nt,{message:r("global.error.label.failed_to_load_data"),messageExtra:ot(f),retry:()=>b().catch(de())})}):i.jsxs(i.Fragment,{children:[i.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[i.jsxs(Br,{ref:c,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:d,children:[i.jsxs(k,{children:[i.jsx(st,{variant:"h5",component:"h3",children:r("chapter.value",{count:C.length})}),!!T&&i.jsx(st,{variant:"body2",color:"warning",children:"".concat(r("chapter.missing",{count:T}))})]}),i.jsxs(k,{direction:"row",children:[j&&i.jsx(Tr,{mangaId:t.id,options:u,updateOption:g,chapters:C,scanlators:F.getScanlators(x),excludeScanlators:u.excludedScanlators}),!!v.length&&i.jsx(ir,{areAllItemsSelected:y,areNoItemsSelected:j,onChange:M=>I(M,M?v:[])})]})]}),w&&i.jsx(nt,{message:r("chapter.error.label.no_chapter_found")}),B&&i.jsx(nt,{message:r("chapter.error.label.no_matches")}),i.jsx(Rr,{persistKey:"manga-".concat(t.id,"-chapter-list"),topOffset:n+s,style:{height:"undefined"},components:{Footer:()=>i.jsx(Qt,{sx:{paddingBottom:Ne}})},totalCount:C.length,computeItemKey:M=>C[M].id,itemContent:M=>i.jsx(ur,{index:M,isSortDesc:u.reverse,chapters:C,selected:j?null:S.includes(C[M].id),showChapterNumber:u.showChapterNumber,onSelect:X}),useWindowScroll:o,overscan:window.innerHeight*.5})]}),i.jsx(Dr,{selectedChapters:S.map(M=>x.find(P=>P.id===M)).filter(M=>M!=null),firstUnreadChapter:t.firstUnreadChapter,onFABMenuClose:J})]})},Ar=t=>{const[e,r]=_.useState(!1),[n,o]=_.useState(null);return[_.useCallback(async()=>{r(!0),o(null),await Promise.all([U.getMangaFetch(t,{awaitRefetchQueries:!0}).response,U.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(a=>{a instanceof he&&ge(a.message)==="no chapters found"||o(a)}).finally(()=>r(!1))},[t]),{loading:e,error:n}]},Vr=Y(i.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}));function $r(t){return me("MuiButtonGroup",t)}const p=fe("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Or=(t,e)=>{const{ownerState:r}=t;return[{["& .".concat(p.grouped)]:e.grouped},{["& .".concat(p.grouped)]:e["grouped".concat(R(r.orientation))]},{["& .".concat(p.grouped)]:e["grouped".concat(R(r.variant))]},{["& .".concat(p.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.orientation))]},{["& .".concat(p.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.color))]},{["& .".concat(p.firstButton)]:e.firstButton},{["& .".concat(p.lastButton)]:e.lastButton},{["& .".concat(p.middleButton)]:e.middleButton},e.root,e[r.variant],r.disableElevation===!0&&e.disableElevation,r.fullWidth&&e.fullWidth,r.orientation==="vertical"&&e.vertical]},Fr=t=>{const{classes:e,color:r,disabled:n,disableElevation:o,fullWidth:s,orientation:a,variant:l}=t,c={root:["root",l,a,s&&"fullWidth",o&&"disableElevation","color".concat(R(r))],grouped:["grouped","grouped".concat(R(a)),"grouped".concat(R(l)),"grouped".concat(R(l)).concat(R(a)),"grouped".concat(R(l)).concat(R(r)),n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return Ce(c,$r,e)},Hr=z("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Or})(_e(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(t.vars||t).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",["& .".concat(p.lastButton,",& .").concat(p.middleButton)]:{borderTopRightRadius:0,borderTopLeftRadius:0},["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderTopRightRadius:0,borderBottomRightRadius:0},["& .".concat(p.lastButton,",& .").concat(p.middleButton)]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderRight:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(p.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"text",orientation:"vertical"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderBottom:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(p.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt()).flatMap(([e])=>[{props:{variant:"text",color:e},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderColor:t.alpha((t.vars||t).palette[e].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},["& .".concat(p.lastButton,",& .").concat(p.middleButton)]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},["& .".concat(p.lastButton,",& .").concat(p.middleButton)]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderRight:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(p.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"contained",orientation:"vertical"},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(p.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt(["dark"])).map(([e])=>({props:{variant:"contained",color:e},style:{["& .".concat(p.firstButton,",& .").concat(p.middleButton)]:{borderColor:(t.vars||t).palette[e].dark}}}))],["& .".concat(p.grouped)]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),zr=_.forwardRef(function(e,r){const n=pe({props:e,name:"MuiButtonGroup"}),{children:o,className:s,color:a="primary",component:l="div",disabled:c=!1,disableElevation:d=!1,disableFocusRipple:u=!1,disableRipple:g=!1,fullWidth:h=!1,orientation:m="horizontal",size:f="medium",variant:b="outlined",...x}=n,C={...n,color:a,component:l,disabled:c,disableElevation:d,disableFocusRipple:u,disableRipple:g,fullWidth:h,orientation:m,size:f,variant:b},v=Fr(C),T=_.useMemo(()=>({className:v.grouped,color:a,disabled:c,disableElevation:d,disableFocusRipple:u,disableRipple:g,fullWidth:h,size:f,variant:b}),[a,c,d,u,g,h,f,b,v.grouped]),w=wr(o),B=w.length,j=y=>{const S=y===0,I=y===B-1;return S&&I?"":S?v.firstButton:I?v.lastButton:v.middleButton};return i.jsx(Hr,{as:l,role:"group",className:be(v.root,s),ref:r,ownerState:C,...x,children:i.jsx(xe.Provider,{value:T,children:w.map((y,S)=>i.jsx(ve.Provider,{value:j(S),children:y},S))})})}),Zt=_.forwardRef(({children:t,...e},r)=>i.jsx(rt,{ref:r,...e,children:i.jsx(k,{direction:"row",sx:{alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:t})})),Pr=Y(i.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),Wr=({manga:t})=>{var d,u;const{t:e}=A(),r=je(),n=U.useGetTrackerList(we),o=(u=(d=n.data)==null?void 0:d.trackers.nodes)!=null?u:[],s=t.trackRecords.nodes,a=ft.getLoggedIn(o),l=ft.getLoggedIn(ft.getTrackers(s,o)),c=g=>{var h;if(n.error){at(e("tracking.error.label.could_not_load_track_info"),"error",(h=n.error)==null?void 0:h.toString());return}if(!a.length){r(N.tracker.path);return}g()};return i.jsx(Nt,{variant:"dialog",popupId:"manga-track-modal",children:g=>i.jsxs(i.Fragment,{children:[i.jsxs(Zt,{...ct(g),size:"medium",disabled:n.loading||!!n.error,onClick:()=>c(g.open),variant:l.length?"contained":"outlined",children:[l.length?i.jsx(Pr,{}):i.jsx(pr,{}),l.length?e("manga.button.track.active",{count:l.length}):e("manga.button.track.start")]}),g.isOpen&&i.jsx(Pt,{...ye(g),maxWidth:"md",fullWidth:!0,scroll:"paper",children:i.jsx(cr,{manga:t})})]})})},Nr=Y(i.jsx("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}));class Gr{constructor(e,r){this.pixels=e,this.opts=r;const{sigBits:n}=r,o=(w,B,j)=>(w<<2*n)+(B<<n)+j;this.getColorIndex=o;const s=8-n,a=1<<3*n,l=new Uint32Array(a);let c,d,u,g,h,m,f,b,x,C;c=u=h=0,d=g=m=Number.MAX_VALUE;const v=e.length/4;let T=0;for(;T<v;){const w=T*4;if(T++,f=e[w+0],b=e[w+1],x=e[w+2],C=e[w+3],C===0)continue;f=f>>s,b=b>>s,x=x>>s;const B=o(f,b,x);l[B]===void 0&&(l[B]=0),l[B]+=1,f>c&&(c=f),f<d&&(d=f),b>u&&(u=b),b<g&&(g=b),x>h&&(h=x),x<m&&(m=x)}this._colorCount=l.reduce((w,B)=>B>0?w+1:w,0),this.hist=l,this.rmax=c,this.rmin=d,this.gmax=u,this.gmin=g,this.bmax=h,this.bmin=m}get colorCount(){return this._colorCount}}class Ur{scaleDown(e){const r=this.getWidth(),n=this.getHeight();let o=1;if(e.maxDimension>0){const s=Math.max(r,n);s>e.maxDimension&&(o=e.maxDimension/s)}else o=1/e.quality;o<1&&this.resize(r*o,n*o,o)}}function qr(t,e){var r;if(e.length>0){const n=t.data,o=n.length/4;let s,a,l,c,d;for(let u=0;u<o;u++){s=u*4,a=n[s+0],l=n[s+1],c=n[s+2],d=n[s+3];for(let g=0;g<e.length;g++)if(!((r=e[g])!=null&&r.call(e,a,l,c,d))){n[s+3]=0;break}}}return t}function Qr(t){const e=new URL(t,location.href);return e.protocol===location.protocol&&e.host===location.host&&e.port===location.port}function Kr(t,e){const r=new URL(t),n=new URL(e);return r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port}class Yr extends Ur{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const e=this.image;if(!e)throw new Error("Image is not initialized");const r=this._canvas=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new ReferenceError("Failed to create canvas context");this._context=n,r.className="@vibrant/canvas",r.style.display="none",this._width=r.width=e.width,this._height=r.height=e.height,n.drawImage(e,0,0),document.body.appendChild(r)}load(e){let r,n;if(typeof e=="string")r=document.createElement("img"),n=e,!Qr(n)&&!Kr(window.location.href,n)&&(r.crossOrigin="anonymous"),r.src=n;else if(e instanceof HTMLImageElement)r=e,n=e.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=r,new Promise((o,s)=>{const a=()=>{this._initCanvas(),o(this)};r.complete?a():(r.onload=a,r.onerror=l=>s(new Error("Fail to load image: ".concat(n))))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(e){this._getContext().putImageData(e,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(e,r,n){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=e,this._height=this._getCanvas().height=r,this._getContext().scale(n,n),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function K(t,...e){return e.forEach(r=>{if(r){for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];Array.isArray(o)?t[n]=o.slice(0):typeof o=="object"?(t[n]||(t[n]={}),K(t[n],o)):t[n]=o}}}),t}function Jr(t,e){const{colorCount:r,quantizer:n,generators:o,filters:s}=t,a={colorCount:r},l=typeof n=="string"?{name:n,options:{}}:n;return l.options=K({},a,l.options),K({},{quantizer:l,generators:o,filters:s},e)}class Xr{constructor(e,r={}){this._src=e,this._opts=K({},H.DefaultOpts,r)}maxColorCount(e){return this._opts.colorCount=e,this}maxDimension(e){return this._opts.maxDimension=e,this}addFilter(e){return this._opts.filters?this._opts.filters.push(e):this._opts.filters=[e],this}removeFilter(e){if(this._opts.filters){const r=this._opts.filters.indexOf(e);r>0&&this._opts.filters.splice(r)}return this}clearFilters(){return this._opts.filters=[],this}quality(e){return this._opts.quality=e,this}useImageClass(e){return this._opts.ImageClass=e,this}useGenerator(e,r){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(r?{name:e,options:r}:e),this}useQuantizer(e,r){return this._opts.quantizer=r?{name:e,options:r}:e,this}build(){return new H(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class mt{constructor(e){this.pipeline=e,this._map={}}names(){return Object.keys(this._map)}has(e){return!!this._map[e]}get(e){return this._map[e]}register(e,r){return this._map[e]=r,this.pipeline}}class Zr{constructor(){this.filter=new mt(this),this.quantizer=new mt(this),this.generator=new mt(this)}_buildProcessTasks({filters:e,quantizer:r,generators:n}){return n.length===1&&n[0]==="*"&&(n=this.generator.names()),{filters:e.map(s=>o(this.filter,s)),quantizer:o(this.quantizer,r),generators:n.map(s=>o(this.generator,s))};function o(s,a){let l,c;return typeof a=="string"?l=a:(l=a.name,c=a.options),{name:l,fn:s.get(l),options:c}}}async process(e,r){const{filters:n,quantizer:o,generators:s}=this._buildProcessTasks(r),a=await this._filterColors(n,e),l=await this._generateColors(o,a),c=await this._generatePalettes(s,l);return{colors:l,palettes:c}}_filterColors(e,r){return Promise.resolve(qr(r,e.map(({fn:n})=>n)))}_generateColors(e,r){return Promise.resolve(e.fn(r.data,e.options))}async _generatePalettes(e,r){const n=await Promise.all(e.map(({fn:o,options:s})=>Promise.resolve(o(r,s))));return Promise.resolve(n.reduce((o,s,a)=>(o[e[a].name]=s,o),{}))}}function tn(t,e,r){return"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1,7)}function en(t,e,r){t/=255,e/=255,r/=255;const n=Math.max(t,e,r),o=Math.min(t,e,r);let s=0,a=0;const l=(n+o)/2;if(n!==o){const c=n-o;switch(a=l>.5?c/(2-n-o):c/(n+o),n){case t:s=(e-r)/c+(e<r?6:0);break;case e:s=(r-t)/c+2;break;case r:s=(t-e)/c+4;break}s/=6}return[s,a,l]}function O(t,e,r){let n,o,s;function a(l,c,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?l+(c-l)*6*d:d<1/2?c:d<2/3?l+(c-l)*(2/3-d)*6:l}if(e===0)n=o=s=r;else{const l=r<.5?r*(1+e):r+e-r*e,c=2*r-l;n=a(c,l,t+1/3),o=a(c,l,t),s=a(c,l,t-1/3)}return[n*255,o*255,s*255]}class D{static applyFilters(e,r){return r.length>0?e.filter(({r:n,g:o,b:s})=>{var a;for(let l=0;l<r.length;l++)if(!((a=r[l])!=null&&a.call(r,n,o,s,255)))return!1;return!0}):e}static clone(e){return new D(e._rgb,e._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[e,r,n]=this._rgb;this._hsl=en(e,r,n)}return this._hsl}get hex(){if(!this._hex){const[e,r,n]=this._rgb;this._hex=tn(e,r,n)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const e=this._rgb;this._yiq=(e[0]*299+e[1]*587+e[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(e,r){this._rgb=e,this._population=r}}const te=class Ct{constructor(e,r){this._src=e,this.opts=K({},Ct.DefaultOpts,r)}static use(e){this._pipeline=e}static from(e){return new Xr(e)}get result(){return this._result}_process(e,r){e.scaleDown(this.opts);const n=Jr(this.opts,r);return Ct._pipeline.process(e.getImageData(),n)}async getPalette(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["default"]});this._result=n;const o=n.palettes.default;if(!o)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return e.remove(),o}catch(r){return e.remove(),Promise.reject(r)}}async getPalettes(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["*"]});this._result=n;const o=n.palettes;return e.remove(),o}catch(r){return e.remove(),Promise.reject(r)}}};te.DefaultOpts={colorCount:64,quality:5,filters:[]};let H=te;H.DefaultOpts.quantizer="mmcq";H.DefaultOpts.generators=["default"];H.DefaultOpts.filters=["default"];H.DefaultOpts.ImageClass=Yr;const _t=5,pt=8-_t;class lt{constructor(e,r,n,o,s,a,l){this.histogram=l,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:e,r2:r,g1:n,g2:o,b1:s,b2:a}}static build(e){const r=new Gr(e,{sigBits:_t}),{rmin:n,rmax:o,gmin:s,gmax:a,bmin:l,bmax:c}=r;return new lt(n,o,s,a,l,c,r)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:e,r2:r,g1:n,g2:o,b1:s,b2:a}=this.dimension;this._volume=(r-e+1)*(o-n+1)*(a-s+1)}return this._volume}count(){if(this._count<0){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension;let d=0;for(let u=n;u<=o;u++)for(let g=s;g<=a;g++)for(let h=l;h<=c;h++){const m=r(u,g,h);e[m]&&(d+=e[m])}this._count=d}return this._count}clone(){const{histogram:e}=this,{r1:r,r2:n,g1:o,g2:s,b1:a,b2:l}=this.dimension;return new lt(r,n,o,s,a,l,e)}avg(){if(!this._avg){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension;let d=0;const u=1<<8-_t;let g,h,m;g=h=m=0;for(let f=n;f<=o;f++)for(let b=s;b<=a;b++)for(let x=l;x<=c;x++){const C=r(f,b,x),v=e[C];v&&(d+=v,g+=v*(f+.5)*u,h+=v*(b+.5)*u,m+=v*(x+.5)*u)}d?this._avg=[~~(g/d),~~(h/d),~~(m/d)]:this._avg=[~~(u*(n+o+1)/2),~~(u*(s+a+1)/2),~~(u*(l+c+1)/2)]}return this._avg}contains(e){let[r,n,o]=e;const{r1:s,r2:a,g1:l,g2:c,b1:d,b2:u}=this.dimension;return r>>=pt,n>>=pt,o>>=pt,r>=s&&r<=a&&n>=l&&n<=c&&o>=d&&o<=u}split(){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension,d=this.count();if(!d)return[];if(d===1)return[this.clone()];const u=o-n+1,g=a-s+1,h=c-l+1,m=Math.max(u,g,h);let f=null,b,x;b=x=0;let C=null;if(m===u){C="r",f=new Uint32Array(o+1);for(let j=n;j<=o;j++){b=0;for(let y=s;y<=a;y++)for(let S=l;S<=c;S++){const I=r(j,y,S);e[I]&&(b+=e[I])}x+=b,f[j]=x}}else if(m===g){C="g",f=new Uint32Array(a+1);for(let j=s;j<=a;j++){b=0;for(let y=n;y<=o;y++)for(let S=l;S<=c;S++){const I=r(y,j,S);e[I]&&(b+=e[I])}x+=b,f[j]=x}}else{C="b",f=new Uint32Array(c+1);for(let j=l;j<=c;j++){b=0;for(let y=n;y<=o;y++)for(let S=s;S<=a;S++){const I=r(y,S,j);e[I]&&(b+=e[I])}x+=b,f[j]=x}}let v=-1;const T=new Uint32Array(f.length);for(let j=0;j<f.length;j++){const y=f[j];y&&(v<0&&y>x/2&&(v=j),T[j]=x-y)}const w=this;function B(j){const y=j+"1",S=j+"2",I=w.dimension[y];let L=w.dimension[S];const J=w.clone(),X=w.clone(),M=v-I,P=L-v;for(M<=P?(L=Math.min(L-1,~~(v+P/2)),L=Math.max(0,L)):(L=Math.max(I,~~(v-1-M/2)),L=Math.min(w.dimension[S],L));!f[L];)L++;let Z=T[L];for(;!Z&&f[L-1];)Z=T[--L];return J.dimension[S]=L,X.dimension[y]=L+1,[J,X]}return B(C)}}class Dt{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(e){this._comparator=e,this.contents=[],this._sorted=!1}push(e){this.contents.push(e),this._sorted=!1}peek(e){return this._sort(),e=typeof e=="number"?e:this.contents.length-1,this.contents[e]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(e){return this._sort(),this.contents.map(e)}}const rn=.75;function Et(t,e){let r=t.size();for(;t.size()<e;){const n=t.pop();if(n&&n.count()>0){const[o,s]=n.split();if(!o||(t.push(o),s&&s.count()>0&&t.push(s),t.size()===r))break;r=t.size()}else break}}const nn=(t,e)=>{if(t.length===0||e.colorCount<2||e.colorCount>256)throw new Error("Wrong MMCQ parameters");const r=lt.build(t);r.histogram.colorCount;const n=new Dt((s,a)=>s.count()-a.count());n.push(r),Et(n,rn*e.colorCount);const o=new Dt((s,a)=>s.count()*s.volume()-a.count()*a.volume());return o.contents=n.contents,Et(o,e.colorCount-o.size()),on(o)};function on(t){const e=[];for(;t.size();){const r=t.pop(),n=r.avg();e.push(new D(n,r.count()))}return e}const sn={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function an(t){let e=0;return t.forEach(r=>{e=Math.max(e,r.population)}),e}function ln(t,e){return t.Vibrant===e||t.DarkVibrant===e||t.LightVibrant===e||t.Muted===e||t.DarkMuted===e||t.LightMuted===e}function cn(t,e,r,n,o,s,a){function l(...d){let u=0,g=0;for(let h=0;h<d.length;h+=2){const m=d[h],f=d[h+1];!m||!f||(u+=m*f,g+=f)}return u/g}function c(d,u){return 1-Math.abs(d-u)}return l(c(t,e),a.weightSaturation,c(r,n),a.weightLuma,o/s,a.weightPopulation)}function W(t,e,r,n,o,s,a,l,c,d){let u=null,g=0;return e.forEach(h=>{const[,m,f]=h.hsl;if(m>=l&&m<=c&&f>=o&&f<=s&&!ln(t,h)){const b=cn(m,a,f,n,h.population,r,d);(u===null||b>g)&&(u=h,g=b)}}),u}function un(t,e,r){const n={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return n.Vibrant=W(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.LightVibrant=W(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.DarkVibrant=W(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.Muted=W(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.LightMuted=W(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.DarkMuted=W(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n}function dn(t,e,r){if(!t.Vibrant&&!t.DarkVibrant&&!t.LightVibrant){if(!t.DarkVibrant&&t.DarkMuted){let[n,o,s]=t.DarkMuted.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}if(!t.LightVibrant&&t.LightMuted){let[n,o,s]=t.LightMuted.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}}if(!t.Vibrant&&t.DarkVibrant){let[n,o,s]=t.DarkVibrant.hsl;s=r.targetNormalLuma,t.Vibrant=new D(O(n,o,s),0)}else if(!t.Vibrant&&t.LightVibrant){let[n,o,s]=t.LightVibrant.hsl;s=r.targetNormalLuma,t.Vibrant=new D(O(n,o,s),0)}if(!t.DarkVibrant&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}if(!t.LightVibrant&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetLightLuma,t.LightVibrant=new D(O(n,o,s),0)}if(!t.Muted&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetMutesSaturation,t.Muted=new D(O(n,o,s),0)}if(!t.DarkMuted&&t.DarkVibrant){let[n,o,s]=t.DarkVibrant.hsl;s=r.targetMutesSaturation,t.DarkMuted=new D(O(n,o,s),0)}if(!t.LightMuted&&t.LightVibrant){let[n,o,s]=t.LightVibrant.hsl;s=r.targetMutesSaturation,t.LightMuted=new D(O(n,o,s),0)}}const hn=(t,e)=>{e=Object.assign({},sn,e);const r=an(t),n=un(t,r,e);return dn(n,r,e),n},gn=new Zr().filter.register("default",(t,e,r,n)=>n>=125&&!(t>250&&e>250&&r>250)).quantizer.register("mmcq",nn).generator.register("default",hn);H.use(gn);/*! Fast Average Color | Â© 2025 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function fn(t){var e=t.toString(16);return e.length===1?"0"+e:e}function At(t){return"#"+t.map(fn).join("")}function mn(t){var e=(t[0]*299+t[1]*587+t[2]*114)/1e3;return e<128}function pn(t){return t?bn(t)?t:[t]:[]}function bn(t){return Array.isArray(t[0])}function wt(t,e,r){for(var n=0;n<r.length;n++)if(xn(t,e,r[n]))return!0;return!1}function xn(t,e,r){switch(r.length){case 3:if(vn(t,e,r))return!0;break;case 4:if(Cn(t,e,r))return!0;break;case 5:if(_n(t,e,r))return!0;break;default:return!1}}function vn(t,e,r){return t[e+3]!==255||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]}function Cn(t,e,r){return t[e+3]&&r[3]?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3]:t[e+3]===r[3]}function tt(t,e,r){return t>=e-r&&t<=e+r}function _n(t,e,r){var n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=t[e+3],d=tt(c,a,l);return a?!!(!c&&d||tt(t[e],n,l)&&tt(t[e+1],o,l)&&tt(t[e+2],s,l)&&d):d}var jn=24;function wn(t,e,r){for(var n={},o=r.dominantDivider||jn,s=r.ignoredColor,a=r.step,l=[0,0,0,0,0],c=0;c<e;c+=a){var d=t[c],u=t[c+1],g=t[c+2],h=t[c+3];if(!(s&&wt(t,c,s))){var m=Math.round(d/o)+","+Math.round(u/o)+","+Math.round(g/o);n[m]?n[m]=[n[m][0]+d*h,n[m][1]+u*h,n[m][2]+g*h,n[m][3]+h,n[m][4]+1]:n[m]=[d*h,u*h,g*h,h,1],l[4]<n[m][4]&&(l=n[m])}}var f=l[0],b=l[1],x=l[2],C=l[3],v=l[4];return C?[Math.round(f/C),Math.round(b/C),Math.round(x/C),Math.round(C/v)]:r.defaultColor}function yn(t,e,r){for(var n=0,o=0,s=0,a=0,l=0,c=r.ignoredColor,d=r.step,u=0;u<e;u+=d){var g=t[u+3],h=t[u]*g,m=t[u+1]*g,f=t[u+2]*g;c&&wt(t,u,c)||(n+=h,o+=m,s+=f,a+=g,l++)}return a?[Math.round(n/a),Math.round(o/a),Math.round(s/a),Math.round(a/l)]:r.defaultColor}function Sn(t,e,r){for(var n=0,o=0,s=0,a=0,l=0,c=r.ignoredColor,d=r.step,u=0;u<e;u+=d){var g=t[u],h=t[u+1],m=t[u+2],f=t[u+3];c&&wt(t,u,c)||(n+=g*g*f,o+=h*h*f,s+=m*m*f,a+=f,l++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(o/a)),Math.round(Math.sqrt(s/a)),Math.round(a/l)]:r.defaultColor}function Vt(t){return Q(t,"defaultColor",[0,0,0,0])}function Q(t,e,r){return t[e]===void 0?r:t[e]}var $t=10,jt=100;function Mn(t){return t.search(/\.svg(\?|$)/i)!==-1}function kn(t){if(ee(t)){var e=t.naturalWidth,r=t.naturalHeight;return!t.naturalWidth&&Mn(t.src)&&(e=r=jt),{width:e,height:r}}return In(t)?{width:t.videoWidth,height:t.videoHeight}:ne(t)?{width:t.codedWidth,height:t.codedHeight}:{width:t.width,height:t.height}}function Ot(t){return Tn(t)?"canvas":Ln(t)?"offscreencanvas":ne(t)?"videoframe":Bn(t)?"imagebitmap":t.src}function ee(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}var re=typeof OffscreenCanvas<"u";function Ln(t){return re&&t instanceof OffscreenCanvas}function In(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function ne(t){return typeof VideoFrame<"u"&&t instanceof VideoFrame}function Tn(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function Bn(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function Rn(t,e){var r=Q(e,"left",0),n=Q(e,"top",0),o=Q(e,"width",t.width),s=Q(e,"height",t.height),a=o,l=s;if(e.mode==="precision")return{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:s,destWidth:a,destHeight:l};var c;return o>s?(c=o/s,a=jt,l=Math.round(a/c)):(c=s/o,l=jt,a=Math.round(l/c)),(a>o||l>s||a<$t||l<$t)&&(a=o,l=s),{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:s,destWidth:a,destHeight:l}}var Dn=typeof window>"u";function En(){return Dn?re?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var An="FastAverageColor: ";function V(t){return Error(An+t)}function q(t,e){e||console.error(t)}var Vn=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(e,r){if(!e)return Promise.reject(V("call .getColorAsync() without resource"));if(typeof e=="string"){if(typeof Image>"u")return Promise.reject(V("resource as string is not supported in this environment"));var n=new Image;return n.crossOrigin=r&&r.crossOrigin||"",n.src=e,this.bindImageEvents(n,r)}else{if(ee(e)&&!e.complete)return this.bindImageEvents(e,r);var o=this.getColor(e,r);return o.error?Promise.reject(o.error):Promise.resolve(o)}},t.prototype.getColor=function(e,r){r=r||{};var n=Vt(r);if(!e){var o=V("call .getColor() without resource");return q(o,r.silent),this.prepareResult(n,o)}var s=kn(e),a=Rn(s,r);if(!a.srcWidth||!a.srcHeight||!a.destWidth||!a.destHeight){var o=V('incorrect sizes for resource "'.concat(Ot(e),'"'));return q(o,r.silent),this.prepareResult(n,o)}if(!this.canvas&&(this.canvas=En(),!this.canvas)){var o=V("OffscreenCanvas is not supported in this browser");return q(o,r.silent),this.prepareResult(n,o)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var o=V("Canvas Context 2D is not supported in this browser");return q(o,r.silent),this.prepareResult(n)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=a.destWidth,this.canvas.height=a.destHeight;try{this.ctx.clearRect(0,0,a.destWidth,a.destHeight),this.ctx.drawImage(e,a.srcLeft,a.srcTop,a.srcWidth,a.srcHeight,0,0,a.destWidth,a.destHeight);var l=this.ctx.getImageData(0,0,a.destWidth,a.destHeight).data;return this.prepareResult(this.getColorFromArray4(l,r))}catch(c){var o=V("security error (CORS) for resource ".concat(Ot(e),".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"));return q(o,r.silent),r.silent||console.error(c),this.prepareResult(n,o)}},t.prototype.getColorFromArray4=function(e,r){r=r||{};var n=4,o=e.length,s=Vt(r);if(o<n)return s;var a=o-o%n,l=(r.step||1)*n,c;switch(r.algorithm||"sqrt"){case"simple":c=yn;break;case"sqrt":c=Sn;break;case"dominant":c=wn;break;default:throw V("".concat(r.algorithm," is unknown algorithm"))}return c(e,a,{defaultColor:s,ignoredColor:pn(r.ignoredColor),step:l,dominantDivider:r.dominantDivider})},t.prototype.prepareResult=function(e,r){var n=e.slice(0,3),o=[e[0],e[1],e[2],e[3]/255],s=mn(e);return{value:[e[0],e[1],e[2],e[3]],rgb:"rgb("+n.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:At(n),hexa:At(e),isDark:s,isLight:!s,error:r}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(e,r){var n=this;return new Promise(function(o,s){var a=function(){d();var u=n.getColor(e,r);u.error?s(u.error):o(u)},l=function(){d(),s(V('Error loading image "'.concat(e.src,'"')))},c=function(){d(),s(V('Image "'.concat(e.src,'" loading aborted')))},d=function(){e.removeEventListener("load",a),e.removeEventListener("error",l),e.removeEventListener("abort",c)};e.addEventListener("load",a),e.addEventListener("error",l),e.addEventListener("abort",c)})},t}();const $n=({manga:t,mangaDynamicColorSchemes:e})=>{const r=Yt(),{setDynamicColor:n}=Se(),o=Wt({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[s,a]=_.useState(!1);return _.useLayoutEffect(()=>{if(!e)return()=>{};const l=new Image;return l.crossOrigin="anonymous",l.src=G.getThumbnailUrl(t),l.onload=()=>{const c=l.width>600&&l.height>600;Promise.all([H.from(l).getPalette(),new Vn().getColor(l,{algorithm:"dominant",mode:c?"speed":"precision",ignoredColor:[[255,255,255,255,75],[0,0,0,255,75]]})]).then(([d,u])=>{!d.Vibrant||!d.DarkVibrant||!d.LightVibrant||!d.LightMuted||!d.Muted||!d.DarkMuted||n({...d,average:u})})},()=>{n(null)}},[]),i.jsxs(i.Fragment,{children:[i.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"150px",maxHeight:"fit-content",aspectRatio:Me,flexShrink:0,flexGrow:0,[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}},children:[i.jsx(bt,{src:G.getThumbnailUrl(t),alt:"Manga Thumbnail",onLoad:()=>a(!0),imgStyle:{width:"100%",height:"100%",objectFit:"cover"}}),s&&i.jsx(k,{...ct(o),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:i.jsx(Nr,{fontSize:"large",color:"primary"})})]}),i.jsx(ke,{...Le(o),sx:{outline:0},children:i.jsx(k,{onClick:()=>o.close(),sx:{height:"100vh",p:2,outline:0,justifyContent:"center",alignItems:"center"},children:i.jsx(bt,{src:G.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},yt=({query:t,sourceId:e,mode:r,children:n})=>{const o=r==="source"&&e!==void 0?N.sources.childRoutes.browse.path(e,t):r==="source.global-search"?N.sources.childRoutes.searchAll.path(t):N.library.path(void 0,t);return i.jsx(vt,{component:it,to:o,sx:{textDecoration:"none",color:"inherit"},children:n!=null?n:t})},Ft="35px",Ht=75,On=({manga:{description:t,genre:e,sourceId:r},mode:n})=>{const[o,s]=_.useState(null),[a,l]=_.useState();Ut(o,_.useCallback(()=>l(o==null?void 0:o.clientHeight),[o]));const[c,d]=Ie("isDescriptionGenreCollapsed",!0),u=t?Math.min(Ht,a!=null?a:Ht):0,g=_.useMemo(()=>e.filter(Boolean),[e]);return i.jsxs(i.Fragment,{children:[t&&i.jsxs(k,{sx:{position:"relative"},children:[i.jsx(Te,{collapsedSize:u,in:!c,children:i.jsx(st,{ref:s,sx:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word",mb:Ft},children:t})}),i.jsx(k,{onClick:()=>d(!c),sx:{justifyContent:"flex-start",alignItems:"center",cursor:"pointer",position:"absolute",width:"100%",height:Ft,bottom:0,background:h=>"linear-gradient(transparent -15px, ".concat(h.palette.background.default,")")},children:i.jsx(E,{sx:{color:h=>h.palette.mode==="light"?"black":"text"},children:c?i.jsx(vr,{}):i.jsx(Cr,{})})})]}),i.jsx(k,{sx:{flexDirection:"row",flexWrap:c?"no-wrap":"wrap",gap:1,overflowX:c?"auto":null},children:g.map(h=>i.jsx(yt,{query:h,sourceId:r,mode:n,children:i.jsx(_r,{label:h,variant:"outlined",onClick:()=>{}})},h))})]})},Fn=z("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Hn=({url:t,mangaThumbnailBackdrop:e,children:r})=>i.jsxs(k,{sx:{position:"relative"},children:[e&&i.jsxs(i.Fragment,{children:[i.jsx(bt,{spinnerStyle:{display:"none"},imgStyle:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},src:t,alt:"Manga Thumbnail"}),i.jsx(k,{sx:{"&::before":n=>De(e,{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(n.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(n.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"})}})]}),r]}),zn=z("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Pn=z("div")(({theme:t})=>({zIndex:1,marginLeft:t.spacing(1)})),et=t=>i.jsx(br,{...t}),Wn=z("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),Nn=({url:t})=>{const{t:e}=A();return i.jsxs(zr,{children:[i.jsx($,{title:e("global.button.open_browser"),disabled:!t,children:i.jsx(Lt,{size:"medium",disabled:!t,component:vt,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(hr,{})})}),i.jsx($,{title:e("global.button.open_webview"),disabled:!t,children:i.jsx(Lt,{size:"medium",disabled:!t,component:vt,href:t?U.getWebviewUrl(t):void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(gr,{})})})]})};function Gn(t){var e;return t?xr.isLocalSource(t)?xt("source.local_source.title"):(e=t.displayName)!=null?e:t.id:xt("global.label.unknown")}const zt=(t,e,r)=>t==null?void 0:t.map(n=>i.jsx(yt,{query:n,sourceId:e,mode:r},n)).reduce((n,o)=>i.jsxs(i.Fragment,{children:[n,", ",o]})),Un=({manga:t,mode:e})=>{var c,d;const{t:r}=A(),{settings:{mangaThumbnailBackdrop:n,mangaDynamicColorSchemes:o}}=Be();_.useEffect(()=>{t.source||at(xt("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:s,updateLibraryState:a}=Ke(t),l=async()=>{try{await navigator.clipboard.writeText(t.title),at(r("global.label.copied_clipboard"),"info")}catch(u){}};return i.jsxs(i.Fragment,{children:[i.jsxs(Fn,{children:[i.jsxs(Hn,{url:G.getThumbnailUrl(t),mangaThumbnailBackdrop:n,children:[i.jsxs(zn,{children:[i.jsx($n,{manga:t,mangaDynamicColorSchemes:o}),i.jsxs(Pn,{children:[i.jsxs(k,{sx:{flexDirection:"row",gap:1,alignItems:"flex-start",mb:1},children:[i.jsx(yt,{query:t.title,sourceId:t.sourceId,mode:"source.global-search",children:i.jsx(st,{variant:"h5",component:"h2",sx:{wordBreak:"break-word"},children:t.title})}),i.jsx($,{title:r("global.button.copy"),children:i.jsx(E,{onClick:l,color:"inherit",children:i.jsx(Vr,{fontSize:"small"})})})]}),t.author&&i.jsx(et,{title:r("manga.label.author"),value:zt(G.getAuthors(t),(c=t.source)==null?void 0:c.id,e)}),t.artist&&i.jsx(et,{title:r("manga.label.artist"),value:zt(G.getArtists(t),(d=t.source)==null?void 0:d.id,e)}),i.jsx(et,{title:r("manga.label.status"),value:r(Re[t.status])}),i.jsx(et,{title:r("source.title_one"),value:Gn(t.source)})]})]}),i.jsxs(Wn,{children:[i.jsxs(Zt,{size:"medium",onClick:a,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?i.jsx(mr,{}):i.jsx(Ye,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),i.jsx(Wr,{manga:t}),i.jsx(Nn,{url:t.realUrl})]})]}),i.jsx(On,{manga:t,mode:e})]}),s]})},qn=({manga:t,onRefresh:e,refreshing:r})=>{const{t:n}=A(),o=Yt(),s=Ee(o.breakpoints.up("sm")),[a,l]=Ae.useState(null),c=!!a,d=()=>{l(null)},{openCategorySelect:u,CategorySelectComponent:g}=Je({mangaId:t.id});return i.jsxs(i.Fragment,{children:[s&&i.jsxs(i.Fragment,{children:[i.jsx($,{title:n("manga.label.reload_from_source"),disabled:r,children:i.jsx(E,{onClick:()=>{e()},disabled:r,color:"inherit",children:i.jsx(kt,{})})}),t.inLibrary&&i.jsxs(i.Fragment,{children:[i.jsx($,{title:n("global.button.migrate"),children:i.jsx(it,{to:N.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:i.jsx(E,{color:"inherit",children:i.jsx(Tt,{})})})}),i.jsx($,{title:n("manga.label.edit_categories"),children:i.jsx(E,{onClick:()=>{u(!0)},color:"inherit",children:i.jsx(Bt,{})})})]})]}),!s&&i.jsxs(i.Fragment,{children:[i.jsx(E,{id:"chaptersMenuButton","aria-controls":c?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,onClick:h=>l(h.currentTarget),color:"inherit",children:i.jsx(Ve,{})}),i.jsxs(Gt,{id:"chaptersMenu",anchorEl:a,open:c,onClose:d,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[i.jsxs(ut,{onClick:()=>{e(),d()},disabled:r,children:[i.jsx(dt,{children:i.jsx(kt,{fontSize:"small"})}),i.jsx(ht,{children:n("manga.label.reload_from_source")})]}),t.inLibrary&&[i.jsxs(ut,{component:it,to:N.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[i.jsx(dt,{children:i.jsx(Tt,{fontSize:"small"})}),i.jsx(ht,{children:n("migrate.title")})]},"migrate"),i.jsxs(ut,{onClick:()=>{u(!0),d()},children:[i.jsx(dt,{children:i.jsx(Bt,{fontSize:"small"})}),i.jsx(ht,{children:n("manga.label.edit_categories")})]},"categories")]]})]}),g]})},zi=()=>{var b,x;const{t}=A(),{id:e}=$e(),{mode:r}=(b=Oe().state)!=null?b:{},n=_.useRef(!1),{data:o,error:s,loading:a,networkStatus:l,refetch:c}=U.useGetManga(Fe,e),d=He(l),u=o==null?void 0:o.manga,[g,{loading:h,error:m}]=Ar(e),f=s!=null?s:m;return _.useEffect(()=>{if(u==null)return;!n.current&&!u.initialized&&(n.current=!0,g())},[u]),jr((x=u==null?void 0:u.title)!=null?x:t("manga.title_one"),i.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[f&&!d&&!h&&i.jsx($,{title:i.jsxs(i.Fragment,{children:[t("manga.error.label.request_failure"),i.jsx("br",{}),ot(f)]}),children:i.jsx(E,{onClick:()=>c(),children:i.jsx(yr,{color:"error"})})}),u&&(h||d)&&i.jsx(E,{disabled:!0,children:i.jsx(ze,{size:16})}),u&&i.jsx(qn,{manga:u,onRefresh:g,refreshing:h})]}),[t,f,d,h,u,g]),f&&!u?i.jsx(nt,{message:t("manga.error.label.request_failure"),messageExtra:ot(f)}):i.jsxs(Qt,{sx:{display:{md:"flex"},overflow:"hidden"},children:[a&&i.jsx(qt,{}),u&&i.jsx(Un,{manga:u,mode:r}),u&&i.jsx(Er,{manga:u,isRefreshing:h})]})};export{zi as Manga};
