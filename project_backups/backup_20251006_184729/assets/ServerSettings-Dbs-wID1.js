import{u as M,ay as H,j as s,r as P,a as K,b as G,H as d,o,p as i,y as q,e as $,g as j,f as L,bC as J,bD as v,bE as _,b0 as p,bF as k,bG as F,m as V,aA as A,bH as N}from"./index-B3NSCdsi.js";import{T as l}from"./TextSetting-Bbq1hKUk.js";import{N as c}from"./NumberSetting-DZ-XTU9n.js";import{S as w}from"./SelectSetting-DYiz4PGL.js";import{E as W}from"./EmptyViewAbsoluteCentered-DBqm8ISe.js";import{u as X}from"./useAppTitle-CiigzFb7.js";import{S as n}from"./Switch-Ba0YZzPv.js";import{L as g}from"./ListSubheader-Ddg_DhEe.js";import{T as Y}from"./Trans-CpvrWOt4.js";import{L as Q}from"./Link-BvpaqdUk.js";import"./Slider-CwwfJui_.js";import"./Select-CbmmqdPd.js";import"./SwitchBase-CZLmNsA7.js";const Z=()=>{const{t:e}=M(),[m,x]=H("serverBaseURL",window.location.origin),h=b=>{const S=b.replaceAll(/(\/)+$/g,"");x(S),P.reset()};return s.jsx(l,{settingName:e("settings.about.server.label.address"),handleChange:h,value:m,placeholder:"http://localhost:4567"})},ee=e=>({ip:e.ip,port:e.port,socksProxyEnabled:e.socksProxyEnabled,socksProxyVersion:e.socksProxyVersion,socksProxyHost:e.socksProxyHost,socksProxyPort:e.socksProxyPort,socksProxyUsername:e.socksProxyUsername,socksProxyPassword:e.socksProxyPassword,debugLogsEnabled:e.debugLogsEnabled,systemTrayEnabled:e.systemTrayEnabled,maxLogFiles:e.maxLogFiles,maxLogFileSize:e.maxLogFileSize,maxLogFolderSize:e.maxLogFolderSize,authMode:e.authMode,authUsername:e.authUsername,authPassword:e.authPassword,jwtAudience:e.jwtAudience,jwtTokenExpiry:e.jwtTokenExpiry,jwtRefreshExpiry:e.jwtRefreshExpiry,flareSolverrEnabled:e.flareSolverrEnabled,flareSolverrTimeout:e.flareSolverrTimeout,flareSolverrUrl:e.flareSolverrUrl,flareSolverrSessionName:e.flareSolverrSessionName,flareSolverrSessionTtl:e.flareSolverrSessionTtl,flareSolverrAsResponseFallback:e.flareSolverrAsResponseFallback,opdsUseBinaryFileSizes:e.opdsUseBinaryFileSizes,opdsItemsPerPage:e.opdsItemsPerPage,opdsEnablePageReadProgress:e.opdsEnablePageReadProgress,opdsMarkAsReadOnDownload:e.opdsMarkAsReadOnDownload,opdsShowOnlyUnreadChapters:e.opdsShowOnlyUnreadChapters,opdsShowOnlyDownloadedChapters:e.opdsShowOnlyDownloadedChapters,opdsChapterSortOrder:e.opdsChapterSortOrder}),se=e=>e===0?A("global.label.never"):A("settings.server.misc.log_files.file_cleanup.value",{days:e,count:e}),me=()=>{var T,C;const{t:e}=M();X(e("settings.server.title.server"));const{settings:{serverInformAvailableUpdate:m},loading:x,request:{error:h,refetch:b}}=K(),S=q(r=>V(e("global.error.label.failed_to_save_changes"),"error",j(r))),{data:R,loading:z,error:E,refetch:O}=P.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[D]=P.useUpdateServerSettings(),t=async(r,y,u)=>{try{await D({variables:{input:{settings:{[r]:y}}}}),u==null||u(!0)}catch(B){V(e("global.error.label.failed_to_save_changes"),"error",j(B)),u==null||u(!1)}},f=G.useMemo(()=>s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-client",children:e("global.label.client")}),children:[s.jsx(Z,{}),s.jsxs(o,{children:[s.jsx(i,{primary:e("global.update.settings.inform.label.title"),secondary:e("global.update.settings.inform.label.description")}),s.jsx(n,{edge:"end",checked:m,onChange:r=>S("serverInformAvailableUpdate",r.target.checked)})]})]}),[m]);if(x||z)return s.jsxs(s.Fragment,{children:[f,s.jsx($,{})]});const U=h!=null?h:E;if(U)return s.jsxs(s.Fragment,{children:[f,s.jsx(W,{message:e("global.error.label.failed_to_load_data"),messageExtra:j(U),retry:()=>{h&&b().catch(L()),E&&O().catch(L())}})]});const a=ee(R.settings),I=!((T=a.authUsername)!=null&&T.trim())||!((C=a.authPassword)!=null&&C.trim());return s.jsxs(d,{sx:{pt:0},children:[f,s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-server-address",children:e("settings.server.address.server.title")}),children:[s.jsx(l,{settingName:e("settings.server.address.server.label.ip"),handleChange:r=>t("ip",r),value:a.ip,placeholder:"0.0.0.0"}),s.jsx(c,{settingTitle:e("settings.server.address.server.label.port"),settingValue:a.port.toString(),handleUpdate:r=>t("port",r),value:a.port,defaultValue:4567,valueUnit:e("settings.server.address.server.label.port")})]}),s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-socks-proxy",children:e("settings.server.socks_proxy.title")}),children:[s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.socks_proxy.label.enable")}),s.jsx(n,{edge:"end",checked:a.socksProxyEnabled,onChange:r=>t("socksProxyEnabled",r.target.checked)})]}),s.jsx(w,{settingName:e("settings.server.socks_proxy.label.version"),value:a.socksProxyVersion,values:[[4,{text:"4"}],[5,{text:"5"}]],handleChange:r=>t("socksProxyVersion",r)}),s.jsx(l,{settingName:e("settings.server.socks_proxy.label.host"),value:a.socksProxyHost,handleChange:r=>t("socksProxyHost",r)}),s.jsx(l,{settingName:e("settings.server.socks_proxy.label.port"),value:a.socksProxyPort,handleChange:r=>t("socksProxyPort",r)}),s.jsx(l,{settingName:e("settings.server.socks_proxy.label.username"),value:a.socksProxyUsername,handleChange:r=>t("socksProxyUsername",r)}),s.jsx(l,{settingName:e("settings.server.socks_proxy.label.password"),value:a.socksProxyPassword,handleChange:r=>t("socksProxyPassword",r),isPassword:!0})]}),s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-auth",children:e("settings.server.auth.title")}),children:[s.jsx(w,{settingName:e("settings.server.auth.label.title"),value:a.authMode,values:J,handleChange:r=>{t("authMode",r,y=>{y&&(r!==v.UiLogin&&N.removeTokens(),N.setAuthRequired(r===v.UiLogin))})},disabled:I}),s.jsx(l,{settingName:e("settings.server.auth.label.username"),value:a.authUsername,validate:r=>a.authMode===v.None||!!r.trim(),handleChange:r=>t("authUsername",r)}),s.jsx(l,{settingName:e("settings.server.auth.label.password"),value:a.authPassword,isPassword:!0,validate:r=>a.authMode===v.None||!!r.trim(),handleChange:r=>t("authPassword",r)}),a.authMode===v.UiLogin&&s.jsxs(s.Fragment,{children:[s.jsx(l,{settingName:e("settings.server.auth.jwt.audience"),value:a.jwtAudience,handleChange:r=>t("jwtAudience",r)}),s.jsx(c,{settingTitle:e("settings.server.auth.jwt.access_token_expiry"),settingValue:p.duration(a.jwtTokenExpiry).humanize(),value:p.duration(a.jwtTokenExpiry).asMinutes(),valueUnit:e("global.time.minutes.minute_other"),defaultValue:_.default,minValue:_.min,maxValue:_.max,handleUpdate:r=>t("jwtTokenExpiry",p.duration(r,"minute").toISOString()),showSlider:!0}),s.jsx(c,{settingTitle:e("settings.server.auth.jwt.refresh_token_expiry"),settingValue:p.duration(a.jwtRefreshExpiry).humanize(),value:p.duration(a.jwtRefreshExpiry).asDays(),valueUnit:e("global.time.days.day_other"),defaultValue:k.default,minValue:k.min,maxValue:k.max,handleUpdate:r=>t("jwtRefreshExpiry",p.duration(r,"day").toISOString()),showSlider:!0})]})]}),s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-clouadflare-bypass",children:e("settings.server.cloudflare.title")}),children:[s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.cloudflare.flaresolverr.enabled.label.title"),secondary:s.jsxs(Y,{i18nKey:"settings.server.cloudflare.flaresolverr.enabled.label.description",children:["See"," ",s.jsx(Q,{href:"https://github.com/FlareSolverr/FlareSolverr?tab=readme-ov-file#installation",target:"_blank",rel:"noreferrer",children:"FlareSolverr"})," ","for information on how to set it up"]})}),s.jsx(n,{edge:"end",checked:a.flareSolverrEnabled,onChange:r=>t("flareSolverrEnabled",r.target.checked)})]}),s.jsx(l,{settingName:e("settings.server.cloudflare.flaresolverr.url.label.title"),dialogDescription:e("settings.server.cloudflare.flaresolverr.url.label.description"),value:a.flareSolverrUrl,handleChange:r=>t("flareSolverrUrl",r)}),s.jsx(c,{settingTitle:e("settings.server.cloudflare.flaresolverr.timeout.label.title"),settingValue:e("global.time.seconds.value",{count:a.flareSolverrTimeout}),dialogDescription:e("settings.server.cloudflare.flaresolverr.timeout.label.description"),value:a.flareSolverrTimeout,defaultValue:60,minValue:20,maxValue:60*5,stepSize:1,showSlider:!0,valueUnit:e("global.time.seconds.second_other"),handleUpdate:r=>t("flareSolverrTimeout",r)}),s.jsx(l,{settingName:e("settings.server.cloudflare.flaresolverr.session.name.label.title"),value:a.flareSolverrSessionName,handleChange:r=>t("flareSolverrSessionName",r)}),s.jsx(c,{settingTitle:e("settings.server.cloudflare.flaresolverr.session.ttl.label.title"),settingValue:e("global.time.minutes.value",{count:a.flareSolverrSessionTtl}),dialogDescription:e("settings.server.cloudflare.flaresolverr.session.ttl.label.description"),value:a.flareSolverrSessionTtl,defaultValue:15,minValue:1,maxValue:60,stepSize:1,showSlider:!0,valueUnit:e("global.time.minutes.minute_other"),handleUpdate:r=>t("flareSolverrSessionTtl",r)}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.cloudflare.flaresolverr.response_fallback.label.title"),secondary:e("settings.server.cloudflare.flaresolverr.response_fallback.label.description")}),s.jsx(n,{edge:"end",checked:a.flareSolverrAsResponseFallback,onChange:r=>t("flareSolverrAsResponseFallback",r.target.checked)})]})]}),s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-opds",children:e("settings.server.opds.title")}),children:[s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.opds.binary_file_sizes.label.title"),secondary:e("settings.server.opds.binary_file_sizes.label.description")}),s.jsx(n,{edge:"end",checked:a.opdsUseBinaryFileSizes,onChange:r=>t("opdsUseBinaryFileSizes",r.target.checked)})]}),s.jsx(c,{settingTitle:e("settings.server.opds.items_per_page.label.title"),settingValue:a.opdsItemsPerPage.toString(),dialogDescription:e("settings.server.opds.items_per_page.label.description"),value:a.opdsItemsPerPage,defaultValue:50,minValue:10,maxValue:5e3,stepSize:10,showSlider:!0,valueUnit:e("settings.server.opds.items_per_page.label.unit_other"),handleUpdate:r=>t("opdsItemsPerPage",r)}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.opds.enable_page_read_progress.label.title"),secondary:e("settings.server.opds.enable_page_read_progress.label.description")}),s.jsx(n,{edge:"end",checked:a.opdsEnablePageReadProgress,onChange:r=>t("opdsEnablePageReadProgress",r.target.checked)})]}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.opds.mark_as_read_on_download.label.title"),secondary:e("settings.server.opds.mark_as_read_on_download.label.description")}),s.jsx(n,{edge:"end",checked:a.opdsMarkAsReadOnDownload,onChange:r=>t("opdsMarkAsReadOnDownload",r.target.checked)})]}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.opds.show_only_unread_chapters.label.title"),secondary:e("settings.server.opds.show_only_unread_chapters.label.description")}),s.jsx(n,{edge:"end",checked:a.opdsShowOnlyUnreadChapters,onChange:r=>t("opdsShowOnlyUnreadChapters",r.target.checked)})]}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.opds.show_only_downloaded_chapters.label.title"),secondary:e("settings.server.opds.show_only_downloaded_chapters.label.description")}),s.jsx(n,{edge:"end",checked:a.opdsShowOnlyDownloadedChapters,onChange:r=>t("opdsShowOnlyDownloadedChapters",r.target.checked)})]}),s.jsx(w,{settingName:e("settings.server.opds.chapter_sort_order.label.title"),dialogDescription:e("settings.server.opds.chapter_sort_order.label.description"),value:a.opdsChapterSortOrder,values:[[F.Asc,{text:e("global.sort.label.asc")}],[F.Desc,{text:e("global.sort.label.desc")}]],handleChange:r=>t("opdsChapterSortOrder",r)})]}),s.jsxs(d,{subheader:s.jsx(g,{component:"div",id:"server-settings-misc",children:e("settings.server.misc.title")}),children:[s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.misc.log_level.label.server")}),s.jsx(n,{edge:"end",checked:a.debugLogsEnabled,onChange:r=>t("debugLogsEnabled",r.target.checked)})]}),s.jsxs(o,{children:[s.jsx(i,{primary:e("settings.server.misc.tray_icon.label.title"),secondary:e("settings.server.misc.tray_icon.label.description")}),s.jsx(n,{edge:"end",checked:a.systemTrayEnabled,onChange:r=>t("systemTrayEnabled",r.target.checked)})]}),s.jsx(c,{settingTitle:e("settings.server.misc.log_files.file_cleanup.title"),settingValue:se(a.maxLogFiles),value:a.maxLogFiles,valueUnit:e("global.date.label.day_one"),handleUpdate:r=>t("maxLogFiles",r)}),s.jsx(l,{settingName:e("settings.server.misc.log_files.file_size.title"),value:a.maxLogFileSize,dialogDescription:e("settings.server.misc.log_files.file_size.description"),validate:r=>!!r.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:r=>t("maxLogFileSize",r)}),s.jsx(l,{settingName:e("settings.server.misc.log_files.total_size.title"),value:a.maxLogFolderSize,dialogDescription:e("settings.server.misc.log_files.total_size.description"),validate:r=>!!r.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:r=>t("maxLogFolderSize",r)})]})]})};export{me as ServerSettings};
