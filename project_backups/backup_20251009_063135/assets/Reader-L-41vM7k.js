import{c_ as bs,b as d,c$ as ht,d0 as We,cV as O,j as s,i as Wt,aB as m,n as Ft,d1 as Zs,d2 as U,d3 as st,E as $e,d4 as Lt,d5 as we,d6 as Ne,d7 as Js,d8 as it,d9 as Ut,S as I,z as $,T as Qe,cE as Qs,da as er,db as tr,dc as Nt,a4 as Xe,ae as $t,dd as Se,C as F,de as Es,df as ge,M as Ye,dg as W,c0 as ue,dh as Te,di as sr,a as rr,cJ as nr,dj as or,dk as ar,dl as ir,cK as cr,as as rt,dm as Qt,aY as et,dn as es,dp as Ts,bz as gt,A as Xt,L as Dt,c as be,u as G,c9 as js,dq as Cs,b9 as ws,ba as As,aG as ft,a7 as jt,a8 as Ct,cb as lr,ax as dr,B as tt,dr as ur,ds as ts,dt as Os,du as Gt,dv as Ls,dw as gr,dx as fr,dy as ss,dz as Ds,dA as pt,b2 as hr,dB as ke,bd as xr,dC as at,dD as Me,s as Is,I as ne,a6 as ze,ck as zt,dE as He,dF as Bs,r as xt,ca as pr,aN as mr,bl as vr,e as It,aX as Rr,dG as Yt,ab as Sr,ac as br,m as Ps,dH as ut,dI as Bt,ar as rs,dJ as Pt,dK as Er,dL as Mt,dM as Tr,dN as wt,dO as jr,dP as _s,bn as Cr,dQ as je,b5 as ye,dR as wr,dS as Ce,dT as Ve,dU as Ar,dV as ys,dW as Or,dX as Lr,dY as vt,dZ as Dr,d_ as Ir,f as bt,d$ as Br,e0 as Pr,g as ks,e1 as Ns,e2 as Ms,e3 as _r,e4 as yr,aJ as Hs,e5 as ns,O as os,e6 as kr,e7 as Nr,e8 as lt,e9 as Q,ea as Rt,eb as as,bm as Mr,ec as Et,ed as Hr,ee as Vr,ef as is,eg as Wr,eh as Fr,d as Ur,ei as Gr,ej as zr,aI as $r,ek as Xr,el as Yr,em as qr}from"./index-B3NSCdsi.js";import{R as Kr,S as Zr,D as Jr,a as Qr,b as en,c as tn}from"./ReaderSettingsTabs-C-Qpg32H.js";import{P as sn}from"./PushPin-BYiJCMYK.js";import{P as rn}from"./PushPinOutlined-C-SjmUwh.js";import{L as Tt}from"./Link-BvpaqdUk.js";import{S as Vs}from"./Select-CbmmqdPd.js";import{C as Ws,c as nn,F as on,l as an,n as cn,a as ln}from"./useManageMangaLibraryState-BUwOAIwu.js";import{q as dn}from"./index-BrsGsN69.js";import{C as un,B as gn,I as fn,b as hn}from"./ChapterListCard-BKt-AMC8.js";import{D as xn}from"./Download-CPjWlyL3.js";import{D as pn}from"./Delete-CRgzWPPc.js";import{D as mn}from"./ChapterCardMetadata-BcJ-3HE_.js";import{F as vn}from"./Favorite-Bd4PFCwq.js";import{C as Rn}from"./CheckboxInput-Dh0Qp3DA.js";import{E as At}from"./EmptyViewAbsoluteCentered-DBqm8ISe.js";import{u as Sn}from"./use-window-event-quZycebx.js";import{u as bn}from"./use-merged-ref-Box3cAY6.js";import{u as En}from"./useAppTitle-CiigzFb7.js";import"./TabsMenu-Dyub9C3h.js";import"./Tabs-DTRAAzXi.js";import"./Trans-CpvrWOt4.js";import"./Slider-CwwfJui_.js";import"./ListSubheader-Ddg_DhEe.js";import"./Add-D_hggg0n.js";import"./ThreeStateCheckboxInput-tKUmVeuL.js";import"./Checkbox-D6x2ifd_.js";import"./SwitchBase-CZLmNsA7.js";import"./FormGroup-CBmCwp4o.js";import"./DoneAll-95vjaRsw.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-BS1h8d31.js";import"./Card-CmqD9oyv.js";import"./CardActionArea-Ggl6ojvp.js";const Tn=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=bs(),t=d.useRef([]);d.useEffect(()=>e?(t.current=[...r],n(ht.NONE),t.current.forEach(o),()=>{o(ht.NONE),t.current.forEach(n)}):()=>{},[e])},jn=({isOpen:e,close:r})=>{const{manga:n}=We(),o=O.useSettings();Tn(e);const[t,a]=d.useState(0),[l,c]=d.useState(!1);return!n||!e?null:s.jsx(Wt,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===Zs.FILTER,sx:{...m(l,{opacity:.75})},children:s.jsx(Ft,{sx:{p:0},children:s.jsx(Kr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...i)=>O.updateSetting(n,...i),deleteSetting:(...i)=>O.deleteSetting(n,...i),setTransparent:c})})})},Cn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:l,progressBarType:c,shouldShowPageNumber:i,readingDirection:h})=>{const g=d.useMemo(()=>{const f=Ne(t,a).name,u="/",p="".concat(f).concat(u).concat(l);return h===it.LTR?p:Js(p,u)},[t,a,l,h]);return!i||o||e&&c===Ut.STANDARD||o&&c===Ut.HIDDEN?null:s.jsx(I,{sx:{position:"fixed",left:n,right:0,bottom:f=>"max(calc(".concat(f.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:f=>"left 0.".concat(f.transitions.duration.shortest,"s")},children:s.jsx($,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(Qe,{sx:{color:"white"},children:g})})})},wn=U(Cn,[O.useOverlayMode,st,$e,Lt,we,O.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function cs(e){return e.substring(2).toLowerCase()}function An(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function On(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,l=d.useRef(!1),c=d.useRef(null),i=d.useRef(!1),h=d.useRef(!1);d.useEffect(()=>(setTimeout(()=>{i.current=!0},0),()=>{i.current=!1}),[]);const g=Qs(er(r),c),f=tr(x=>{const S=h.current;h.current=!1;const v=Nt(c.current);if(!i.current||!c.current||"clientX"in x&&An(x,v))return;if(l.current){l.current=!1;return}let C;x.composedPath?C=x.composedPath().includes(c.current):C=!v.documentElement.contains(x.target)||c.current.contains(x.target),!C&&(n||!S)&&t(x)}),u=x=>S=>{h.current=!0;const v=r.props[x];v&&v(S)},p={ref:g};return a!==!1&&(p[a]=u(a)),d.useEffect(()=>{if(a!==!1){const x=cs(a),S=Nt(c.current),v=()=>{l.current=!0};return S.addEventListener(x,f),S.addEventListener("touchmove",v),()=>{S.removeEventListener(x,f),S.removeEventListener("touchmove",v)}}},[f,a]),o!==!1&&(p[o]=u(o)),d.useEffect(()=>{if(o!==!1){const x=cs(o),S=Nt(c.current);return S.addEventListener(x,f),()=>{S.removeEventListener(x,f)}}},[f,o]),d.cloneElement(r,p)}const ls=Xe(Qe)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Ln=Xe(I,{shouldForwardProp:$t(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(Se(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(Se(r).isVertical,{top:0,bottom:0}),...m(Se(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(Se(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),Dn=Xe(I)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),In=Xe(I)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Bn=Xe($,{shouldForwardProp:$t(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(Se(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(Se(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),Pn=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:l})=>s.jsx(F,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Es[l],children:s.jsx($,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(Se(l).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(Se(l).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),_n=Xe(I)({position:"relative",flexDirection:"row",flexGrow:1}),yn=d.memo(Xe($,{shouldForwardProp:$t(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),kn=d.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:l,primaryPageLoadState:c,secondaryPageLoadState:i,createProgressBarSlot:h,...g})=>{const f=d.useMemo(()=>h(e,r,c,i,n,o,t,a,l),[h,e,r,c,i,n,o,t,a,l]);return s.jsx(yn,{...g,isFirstPage:r===0,isLastPage:r===a-1,children:f})}),Nn=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:l,progressBarPosition:c,readingMode:i,isDragging:h,setIsDragging:g,openPage:f,direction:u,fullSegmentClicks:p})=>{var j,P,M,D,H,Y,V,z,q,B,J,fe,K,Z,le,N,oe,me,he,ve,Re,xe,ae,re,Ae,pe,Fe,Oe,Ue,Le,qe,De;const x=d.useRef(null),S=d.useRef(void 0),[v,C]=d.useState(0),R=d.useRef(null);Ye(R,d.useCallback(()=>{const y=R.current;if(!y)return;const{paddingLeft:k,paddingRight:Ie}=getComputedStyle(y),Ke=6,Be=y.clientWidth-parseFloat(k)-parseFloat(Ie),ie=i===W.DOUBLE_PAGE?Be*2+Ke:Be;C(ie)},[i]));const E=d.useMemo(()=>Ne(o,r).pagesIndex,[o,r]),w=Se(c).isHorizontal,T=d.useMemo(()=>Ne(o,r),[o,r]),L=d.useCallback((...y)=>ue(y[0],y[1],u),[u]);ge.useHandleProgressDragging(f,x,h,T,r,c,L,p);const _=y=>{if(!x.current)return;const k="touches"in y;f(Te(sr(k?y.touches[0]:y,x.current,r,w,p,L)),void 0,!1),clearTimeout(S.current),S.current=setTimeout(()=>g(!0),250)},b=()=>{g(!1),clearTimeout(S.current)};return s.jsx(Ln,{...t==null?void 0:t.container,progressBarPosition:c,children:s.jsxs(Dn,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(ls,{...(j=t==null?void 0:t.progressBarPageTexts)==null?void 0:j.base,...(P=t==null?void 0:t.progressBarPageTexts)==null?void 0:P.current,sx:[{width:"".concat(v,"px")},...Array.isArray((D=(M=t==null?void 0:t.progressBarPageTexts)==null?void 0:M.base)==null?void 0:D.sx)?(V=(Y=(H=t==null?void 0:t.progressBarPageTexts)==null?void 0:H.base)==null?void 0:Y.sx)!=null?V:[]:[(q=(z=t==null?void 0:t.progressBarPageTexts)==null?void 0:z.base)==null?void 0:q.sx],...Array.isArray((J=(B=t==null?void 0:t.progressBarPageTexts)==null?void 0:B.current)==null?void 0:J.sx)?(Z=(K=(fe=t==null?void 0:t.progressBarPageTexts)==null?void 0:fe.current)==null?void 0:K.sx)!=null?Z:[]:[(N=(le=t==null?void 0:t.progressBarPageTexts)==null?void 0:le.current)==null?void 0:N.sx]],onClick:()=>f("previous","ltr",!1),children:T.name}),s.jsx(On,{onClickAway:()=>g(!1),children:s.jsxs(_n,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:_,onMouseUp:b,onTouchStart:_,onTouchEnd:b,children:[s.jsxs(In,{ref:x,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((y,k)=>d.createElement(kn,{...t==null?void 0:t.progressBarSlot,key:y.primary.index,page:y,pagesIndex:k,isCurrentPage:k===E,isLeadingPage:k<E,isTrailingPage:k>E,totalPages:r.length,primaryPageLoadState:n[y.primary.index].loaded,secondaryPageLoadState:y.secondary?n[y.secondary.index].loaded:void 0,createProgressBarSlot:l,showDraggingStyle:k===E&&h})),s.jsx(Bn,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:T.pagesIndex,pagesLength:r.length,progressBarPosition:c})]}),s.jsx(Pn,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:T.name,currentPagesIndex:T.pagesIndex,pagesLength:r.length,isDragging:h,progressBarPosition:c,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(ls,{ref:R,...(oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:oe.base,...(me=t==null?void 0:t.progressBarPageTexts)==null?void 0:me.total,sx:[{minWidth:"unset"},...Array.isArray((ve=(he=t==null?void 0:t.progressBarPageTexts)==null?void 0:he.base)==null?void 0:ve.sx)?(ae=(xe=(Re=t==null?void 0:t.progressBarPageTexts)==null?void 0:Re.base)==null?void 0:xe.sx)!=null?ae:[]:[(Ae=(re=t==null?void 0:t.progressBarPageTexts)==null?void 0:re.base)==null?void 0:Ae.sx],...Array.isArray((Fe=(pe=t==null?void 0:t.progressBarPageTexts)==null?void 0:pe.total)==null?void 0:Fe.sx)?(Le=(Ue=(Oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:Oe.total)==null?void 0:Ue.sx)!=null?Le:[]:[(De=(qe=t==null?void 0:t.progressBarPageTexts)==null?void 0:qe.total)==null?void 0:De.sx]],onClick:()=>f("next","ltr",!1),children:e})]})})},Fs=U(d.memo(Nn),[Lt,()=>({openPage:ge.useOpenPage()}),we,O.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),Mn=d.forwardRef(({direction:e,...r},n)=>{const{settings:{customThemes:o,appTheme:t,themeMode:a,shouldUsePureBlackMode:l}}=rr(),c=d.useMemo(()=>nr(a,or(t,o),l,e),[a,t,o,l,e]);return s.jsx(ar,{value:ir[e],children:s.jsx(cr,{theme:c,children:s.jsx($,{...r,ref:n,dir:e})})})}),Us=U(Mn,[()=>({direction:O.useGetThemeDirection()})],["direction"]),Gs=d.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx(F,{...n==null?void 0:n.tooltip,title:e,placement:Es[r],children:s.jsx($,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),Hn=d.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:l})=>{const c=rt();return s.jsx(Gs,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:Qt(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:Qt(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx($,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:et(c.palette.primary.main,.5)}),...m(t,{cursor:l?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),Vn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:l,progressBarPositionAutoVertical:c,readerDirection:i,scrollbarXSize:h,scrollbarYSize:g,totalPages:f})=>{const u=rt(),[,p]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>p({}),[]));const x=Ts(l,c,g,e+h),{isBottom:S,isLeft:v,isRight:C,isVertical:R,isHorizontal:E}=Se(x),w=!!f,T=t===Ut.HIDDEN,L=!r&&!o;return s.jsx(Us,{children:s.jsx(Fs,{direction:E?i:"ltr",progressBarPosition:x,fullSegmentClicks:!0,createProgressBarSlot:d.useCallback((_,b,j,P,M,D,H,Y,V)=>s.jsx(Hn,{pageName:_.name,primaryPageLoadState:j,secondaryPageLoadState:P,progressBarPosition:x,isCurrentPage:M,isLeadingPage:D,showDraggingStyle:V}),[x]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(u.transitions.duration.shortest,"s"),...m(E,{minHeight:"100px",...m(u.direction==="ltr",{left:i==="ltr"?e:g,right:i==="rtl"?e:g}),...m(u.direction==="rtl",{left:i==="rtl"?e:g,right:i==="ltr"?e:g})}),...m(R,{minWidth:"100px",bottom:"".concat(h,"px")}),...m(S,{bottom:"".concat(h,"px")}),...m(v,{...m(u.direction==="ltr",{left:i==="ltr"?e:"unset",right:i==="rtl"?e:"unset"}),...m(u.direction==="rtl",{right:i==="rtl"?g:"unset",left:i==="ltr"?g:"unset"})}),...m(C,{...m(u.direction==="ltr",{right:i==="ltr"?g:"unset",left:i==="rtl"?g:"unset"}),...m(u.direction==="rtl",{left:i==="rtl"?e:"unset",right:i==="ltr"?e:"unset"})}),...m(L,{opacity:T?0:.85}),...m(!w,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(R,{flexDirection:"column",height:"100%"}),...m(L,{backgroundColor:"unset",pointerEvents:"none",...m(E,{px:2}),...m(R,{py:2}),...m(S,{pb:.25}),...m(v,{...m(u.direction==="ltr",{pl:i==="ltr"?.25:0,pr:i==="rtl"?.25:0}),...m(u.direction==="rtl",{pr:i==="rtl"?.25:0,pl:i==="ltr"?.25:0})}),...m(C,{...m(u.direction==="ltr",{pr:i==="ltr"?.25:0,pl:i==="rtl"?.25:0}),...m(u.direction==="rtl",{pl:i==="rtl"?.25:0,pr:i==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(E,{height:"20px"}),...m(R,{flexDirection:"column",width:"20px"}),...m(L,{...m(E,{height:"".concat(a,"px")}),...m(R,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(L,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Wn=U(d.memo(Vn),[$e,Lt,O.useSettingsWithoutDefaultFlag,()=>({readerDirection:O.useGetThemeDirection()}),st,we],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Fn=Xe(I)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Un=d.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(I,{children:[s.jsx(F,{title:r,placement:"right",children:s.jsx(gt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx(Tt,{component:Dt,to:Xt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx(F,{title:n,placement:"right",children:s.jsx(gt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx(F,{title:o,placement:"right",children:s.jsx(gt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),Gn=be(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),zn=be(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Ot=({title:e,type:r,disabled:n,...o})=>s.jsx(F,{title:e,disabled:n,children:s.jsx(Ws,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(Gn,{}):s.jsx(zn,{})})}),$n=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=G(),a=js(),l=d.useMemo(()=>Ne(e,r),[e,r]),c=Cs[n];return s.jsxs(I,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ot,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",c)),disabled:a(!l.primary.index,Te(l)===Te(r.slice(-1)[0]),c),onClick:()=>o("previous",void 0,!1)}),s.jsxs(ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(As,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Vs,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:Te(l),onChange:i=>o(i.target.value,void 0,!1),children:r.map(i=>s.jsx(ft,{value:Te(i),children:i.name},Te(i)))})]}),s.jsx(Ot,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",c)),disabled:a(Te(l)===Te(r.slice(-1)[0]),!l.primary.index,c),onClick:()=>o("next",void 0,!1)})]})},Xn=U(d.memo($n),[we,()=>({openPage:ge.useOpenPage()}),O.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),Yn=()=>{},zs=({currentChapter:e,chapters:r,style:n})=>{const o=d.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(dn,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(un,{index:t,chapters:r,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:Yn,selectable:!1,isActiveChapter:t===o}),increaseViewportBy:400})},qn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var i,h;const{t:l}=G(),c=jt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return d.useLayoutEffect(()=>{c.close()},[e==null?void 0:e.id]),s.jsxs(I,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ot,{type:"previous",title:l(ue("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(ue("previous","next",t))},disabled:ue(!r,!n,t)}),s.jsxs(ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(As,{id:"reader-nav-bar-desktop-chapter-select",children:l("chapter.title_one")}),s.jsx(Vs,{...Ct(c),open:c.isOpen,value:(i=e==null?void 0:e.id)!=null?i:0,MenuProps:{sx:{visibility:"hidden"}},label:l("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(ft,{value:(h=e==null?void 0:e.id)!=null?h:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(Ot,{component:Dt,type:"next",title:l(ue("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(ue("next","previous",t))},disabled:ue(!n,!r,t)}),s.jsx(lr,{...dr(c),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx($,{sx:{mb:1},children:s.jsx(zs,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},Kn=U(d.memo(qn),[()=>({readerThemeDirection:O.useGetThemeDirection()}),()=>({openChapter:ge.useOpenChapter()})],["readerThemeDirection","openChapter"]),Zn=be(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),$s=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},qt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:l,onDefault:c,defaultIcon:i})=>{const{t:h}=G(),g=r===void 0,f=d.useMemo(()=>g?-1:o.indexOf(r),[r,o]);return s.jsx(F,{title:e,children:g?s.jsx(tt,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i,size:"large",children:n===void 0?h("global.label.default"):s.jsx(Zr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:h(a[n].title)})}):s.jsx(tt,{onClick:()=>{const u=$s(f,o,l);if(u===void 0){c==null||c();return}t(u)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:h(a[r].title)})})},Jn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=G();return s.jsxs(I,{sx:{flexDirection:"row",gap:1},children:[s.jsx(qt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:a=>n("pageScaleMode",a),valueToDisplayData:ts,defaultIcon:ts[e.value].icon}),ur[e.value]&&s.jsx(F,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Ws,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(Zn,{})})})]})},Qn=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=G();return s.jsx(qt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:Gt,defaultIcon:Gt[e.value].icon})},eo=()=>s.jsx(gr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),to=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=G();return fr(e)?s.jsx(tt,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(eo,{}),children:o("reader.settings.label.offset_double_spread")}):null},so=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=G();return s.jsx(qt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ds,setValue:r,valueToDisplayData:ss,defaultIcon:ss[e.value].icon})},ro=be(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),no=be(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),oo=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=G(),{isActive:o,toggleActive:t}=pt(),a=d.useRef(void 0);return s.jsxs(I,{sx:{flexDirection:"row",gap:1},children:[s.jsx(tt,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(ro,{}):s.jsx(no,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(hr,{value:e.value,type:"number",size:"small",onBlur:l=>{const c=at(+l.target.value,ke.min,ke.max);c!==e.value&&(clearTimeout(a.current),r({...e,value:c},!0))},onChange:l=>{const c=at(+l.target.value,ke.min,ke.max);r({...e,value:c},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:ke,endAdornment:s.jsx(xr,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},ao=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:l,openSettings:c})=>{const{t:i}=G(),h=O.useCreateUpdateSetting(e!=null?e:Me),g=O.useCreateDeleteSetting(e!=null?e:Me);return s.jsxs(I,{sx:{gap:1},children:[s.jsx(Qn,{readingMode:r,setReadingMode:f=>h("readingMode",f),isDefaultable:!0,onDefault:()=>g("readingMode")}),s.jsx(to,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:f=>h("shouldOffsetDoubleSpreads",f)}),s.jsx(Jn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:h,isDefaultable:!0,onDefault:()=>g("pageScaleMode")}),s.jsx(so,{readingDirection:a,setReadingDirection:f=>h("readingDirection",f),isDefaultable:!0,onDefault:()=>g("readingDirection")}),s.jsx(oo,{autoScroll:l,setAutoScroll:(...f)=>h("autoScroll",...f)}),s.jsx(tt,{onClick:()=>c(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(Is,{}),children:i("settings.title")})]})},io=U(ao,[We,O.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),co=be(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ds={...Me,title:"Fallback",inLibrary:!1},lo=({manga:e})=>{const{inLibrary:r}=e!=null?e:ds,{t:n}=G(),{CategorySelectComponent:o,updateLibraryState:t}=nn(e!=null?e:ds,!0);return s.jsxs(s.Fragment,{children:[s.jsx(F,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(ne,{onClick:t,color:"inherit",children:r?s.jsx(vn,{}):s.jsx(on,{})})}),o]})},Xs=U(d.memo(lo),[We],["manga"]),uo=be(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),go=({id:e,isBookmarked:r})=>{const{t:n}=G(),o=r?"unbookmark":"bookmark";return s.jsx(F,{title:n(zt[o].action.single),children:s.jsx(ne,{onClick:()=>ze.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(gn,{}):s.jsx(uo,{})})})},Ys=d.memo(go),fo=({currentChapter:e})=>{var o;const{t:r}=G(),n=ze.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&ze.isDownloaded(e)?s.jsx(F,{title:r(zt.delete.action.single),children:s.jsx(ne,{onClick:()=>ze.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(pn,{})})}):n?s.jsx(mn,{chapterId:n.chapter.id}):s.jsx(F,{title:r(zt.download.action.single),disabled:!e,children:s.jsx(ne,{disabled:!e,onClick:()=>{var t;return ze.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(xn,{})})})},ho=d.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:l}=e!=null?e:Bs,{t:c}=G(),i=d.useRef(0),h=d.useMemo(()=>r.some(g=>g.error),[r]);return s.jsxs(I,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Xs,{}),s.jsx(Ys,{id:t,isBookmarked:a}),s.jsx(F,{title:c("reader.button.retry_load_pages"),disabled:!h,children:s.jsx(ne,{onClick:()=>{n(g=>g.map(f=>({url:f.url,loaded:f.loaded}))),o("".concat(i.current)),i.current=(i.current+1)%1e3},disabled:!h,color:"inherit",children:s.jsx(co,{})})}),s.jsx(fo,{currentChapter:e}),s.jsx(F,{title:c("global.button.open_browser"),disabled:!l,children:s.jsx(ne,{disabled:!l,href:l!=null?l:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(fn,{})})}),s.jsx(F,{title:c("global.button.open_webview"),disabled:!l,children:s.jsx(ne,{disabled:!l,href:l?xt.getWebviewUrl(l):"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(hn,{})})})]})}),xo=U(ho,[He,we],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),po=({exit:e})=>{const{t:r}=G(),n=js();return s.jsx(F,{title:r("reader.button.exit"),children:s.jsx(ne,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(pr,{}),s.jsx(mr,{}))})})},qs=U(d.memo(po),[()=>({exit:O.useExit()})],["exit"]),mo=(e,r)=>{const n=d.useRef(r),o=d.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},vo=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:l,nextChapter:c,isStaticNav:i})=>{const{t:h}=G(),g=O.useCreateUpdateSetting(o!=null?o:Me),[f,u]=d.useState();Ye(f,d.useCallback(()=>{i&&n(f.offsetWidth)},[f,i])),d.useLayoutEffect(()=>()=>n(0),[]);const S=mo(e,i)&&e?0:void 0;return s.jsx(vr,{variant:i?"permanent":"persistent",open:e||i,transitionDuration:S,SlideProps:{unmountOnExit:!0},PaperProps:{ref:v=>u(v)},children:s.jsxs(Fn,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(I,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(I,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(qs,{}),s.jsx(F,{title:h("reader.settings.label.static_navigation"),children:s.jsx(ne,{onClick:()=>{n(0),g("isStaticNav",!i)},color:i?"primary":"inherit",children:i?s.jsx(sn,{}):s.jsx(rn,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Un,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(xo,{})]}):s.jsx(It,{})]}),s.jsxs(I,{sx:{p:2,gap:2},children:[s.jsxs(I,{sx:{gap:1},children:[s.jsx(Xn,{}),s.jsx(Kn,{chapters:t,currentChapter:a,nextChapter:c,previousChapter:l})]}),s.jsx(Rr,{}),s.jsx(io,{openSettings:r})]})]})})},Ro=U(d.memo(vo),[$e,We,He,we,O.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),So={...Me,title:""},bo=d.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=G(),l=jt({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:c,title:i}=r!=null?r:So,{id:h,name:g,realUrl:f,isBookmarked:u}=n!=null?n:Bs;return s.jsx(Yt,{direction:"down",in:e,ref:t,children:s.jsxs(I,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:p=>"max(env(safe-area-inset-top), ".concat(p.spacing(2),")"),backgroundColor:p=>et(p.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(qs,{}),s.jsx(I,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx(F,{title:i,children:s.jsx(gt,{lines:1,component:"h1",variant:"h5",children:s.jsx(Tt,{component:Dt,to:Xt.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:i})})}),s.jsx(F,{title:g,children:s.jsx(gt,{lines:1,children:g})})]}):s.jsx(It,{})}),s.jsx(Xs,{}),s.jsx(Ys,{id:h,isBookmarked:u}),s.jsx(ne,{...Ct(l),color:"inherit",children:s.jsx(an,{})}),s.jsxs(Sr,{...br(l),children:[s.jsx(ft,{component:Tt,disabled:!f,href:f!=null?f:"",rel:"noreferrer",target:"_blank",children:a("global.button.open_browser")}),s.jsx(ft,{component:Tt,disabled:!f,href:f?xt.getWebviewUrl(f):"",rel:"noreferrer",target:"_blank",children:a("global.button.open_webview")}),s.jsx(ft,{disabled:!f,onClick:async()=>{await navigator.clipboard.writeText(i),Ps(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),Eo=U(d.memo(bo),[We,He,st],["manga","currentChapter","scrollbarYSize"]),To=be(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),jo=be(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),us=be(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),gs=be(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),Co={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},fs="3px",wo=d.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx($,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:fs,height:fs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Ao=d.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})=>s.jsx(Gs,{pageName:e,progressBarPosition:ut.BOTTOM,slotProps:{box:{sx:Co}},children:!n&&s.jsx(wo,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})})),Oo={[ut.BOTTOM]:"up",[ut.LEFT]:"right",[ut.RIGHT]:"left",[ut.AUTO]:"left"},Lo=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:l,direction:c,progressBarPosition:i,progressBarPositionAutoVertical:h,topOffset:g=0,bottomOffset:f=0,scrollbarXSize:u})=>{const p=ge.useOpenChapter(),[,x]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>x({}),[]));const S=Ts(i,h,g+f,u),{isLeft:v,isRight:C,isVertical:R,isHorizontal:E}=Se(S),w=E?c:"ltr",T=d.useMemo(()=>Ne(a,l).pagesIndex,[a,l]),L=d.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:b=>et(b.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(R,{flexDirection:"column"}),...m(E,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(R,{width:"100%",flexDirection:"column",px:2}),...m(E,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(R,{flexDirection:"column",py:1}),...m(E,{px:1})}},progressBarSlot:{sx:{...m(R,{width:"20px"}),...m(E,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(R,{justifyContent:"center"}),...m(E,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(R,{py:1}),...m(E,{px:1})}}}}),[R,E]),_=d.useMemo(()=>({progressBarCurrentPage:s.jsx($,{sx:{position:"absolute",...m(R,{top:"calc(100% - 6px)",...m(T===0,{top:"0"}),width:"75%",height:"6px"}),...m(E,{left:"calc(100% - 0px)",...m(T===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[T,l.length,t,R,E]);return d.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Yt,{direction:Oo[S],in:n,children:s.jsx(Us,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(v,{justifyContent:c==="ltr"?"start":"end"}),...m(C,{justifyContent:c==="ltr"?"end":"start"})},children:s.jsxs(I,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(R,{height:"100%",flexDirection:"column"}),...m(E,{width:"100%",flexDirection:"row"})},children:[s.jsx(ne,{onClick:()=>p("previous"),disabled:!e,sx:{backgroundColor:b=>et(b.palette.background.paper,.85),boxShadow:2},children:ue(s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)}),s.jsx(Fs,{direction:w,progressBarPosition:S,fullSegmentClicks:!1,createProgressBarSlot:d.useCallback((b,j,P,M,D,H,Y,V)=>s.jsx(Ao,{pageName:b.name,isTrailingPage:Y,isCurrentPage:D,pagesIndex:j,totalPages:V,isVertical:R,isHorizontal:E}),[R,E]),slotProps:{...L,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(R,{width:"20px",height:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(E,{width:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:_}),s.jsx(ne,{onClick:()=>p("next"),disabled:!r,sx:{backgroundColor:b=>et(b.palette.background.paper,.85),boxShadow:2},children:ue(s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)})]})})})},Do=U(d.memo(Lo),[He,Bt,Lt,we,()=>({direction:O.useGetThemeDirection()}),O.useSettingsWithoutDefaultFlag,st],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Io=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:l}=G(),c=O.useCreateDeleteSetting(e!=null?e:Me);return e?s.jsxs(I,{sx:{gap:2},children:[s.jsx(Jr,{}),s.jsx(Qr,{readingMode:r,setReadingMode:i=>O.updateSetting(e,"readingMode",i),isDefaultable:!0,onDefault:()=>c("readingMode")}),s.jsx(en,{readingDirection:n,setReadingDirection:i=>O.updateSetting(e,"readingDirection",i),isDefaultable:!0,onDefault:()=>c("readingDirection")}),s.jsx(Rn,{label:l("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(tn,{autoScroll:o,setAutoScroll:(...i)=>O.updateSetting(e,"autoScroll",...i)})]}):null},Bo=U(d.memo(Io),[We,O.useSettings,pt],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Po=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:l=0})=>{const{t:c}=G(),i=jt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),h=jt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[g,f]=d.useState(0),u=d.useRef(null);return Ye(u,d.useCallback(()=>{var p,x;return f((x=(p=u.current)==null?void 0:p.clientHeight)!=null?x:0)},[g])),d.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(I,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(l,"px)")},children:[s.jsx(Do,{topOffset:l,bottomOffset:g}),s.jsx(Yt,{direction:"up",in:r,children:s.jsx(I,{ref:u,sx:{alignItems:"center",backgroundColor:p=>et(p.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(I,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx(F,{title:c("reader.button.chapter_list"),children:s.jsx(ne,{...Ct(i),color:"inherit",children:s.jsx(jo,{})})}),s.jsx(F,{title:c("reader.settings.title.quick_settings"),children:s.jsx(ne,{...Ct(h),color:"inherit",children:s.jsx(To,{})})}),s.jsx(F,{title:c("settings.title"),children:s.jsx(ne,{onClick:e,color:"inherit",children:s.jsx(Is,{})})})]})})})]}),i.isOpen&&s.jsx(Wt,{...rs(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Ft,{sx:{p:0,pb:1},children:s.jsx(zs,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),h.isOpen&&s.jsx(Wt,{...rs(h),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Ft,{children:s.jsx(Bo,{})})})]})},_o=U(d.memo(Po),[He,st],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),yo=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=d.useState(!1),[a,l]=d.useState(0),c=d.useRef(null);return Ye(c,d.useCallback(()=>{var i,h;return l((h=(i=c.current)==null?void 0:i.clientHeight)!=null?h:0)},[n])),s.jsxs($,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Wn,{}),s.jsx(Ro,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(Eo,{ref:c,isVisible:e}),s.jsx(_o,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(jn,{isOpen:o,close:()=>t(!1)}),s.jsx(wn,{})]})},ko=U(d.memo(yo),[O.useOverlayMode],["isDesktop","isMobile"]),hs="reader-tap-zone-layout-canvas",No=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=rt(),[l,c]=d.useState(0),[i,h]=d.useState(0),[g,f]=d.useState(null);Ye(g,d.useCallback(()=>{var p,x;c((p=g==null?void 0:g.clientWidth)!=null?p:0),h((x=g==null?void 0:g.clientHeight)!=null?x:0)},[g]));const u=Er.getOrCreateCanvas(n,l,i,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===it.RTL});return d.useLayoutEffect(()=>{const p=document.getElementById(hs);p==null||p.replaceChildren(u)},[u,r]),s.jsx($,{ref:f,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:hs})})},Mo=U(No,[$e,Pt,O.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),Ho=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:l}}})=>l?s.jsx($,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,Vo=U(Ho,[$e,O.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),xs=2,dt=0,ee=0,te=1,Wo=(e,r=Mt.XY)=>{const[n,o]=d.useState(!1),t=d.useRef(void 0),a=d.useRef([0,0,0]),l=d.useRef([0,0,0]),c=d.useRef([0,0,0]),i=d.useRef([0,0]),h=d.useRef(void 0),g=d.useRef([0,0]),f=d.useRef([0,0]);return d.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const p=()=>{t.current||(t.current=getComputedStyle(u));const b=t.current.direction==="rtl",j=t.current.flexDirection==="row-reverse";return b||!b&&j},x=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),S=r!==Mt.Y,v=r!==Mt.X,C=()=>{h.current!==void 0&&(cancelAnimationFrame(h.current),h.current=void 0)},R=()=>{const b=(le,N,oe)=>(le[dt]-le[xs])/(N[dt]-N[xs])*1e3/oe,j=[S?b(a.current,c.current,u.clientWidth):0,v?b(l.current,c.current,u.clientHeight):0],P=S&&v?Math.sqrt(j[ee]**2+j[te]**2):Math.abs(v?j[te]:j[ee]),M=[j[ee]/P,j[te]/P],D=at(1.2*P,-12,12),H=(Date.now()-c.current[dt])/1e3,Y=D-14.278*H+75.24*H**2/D-149.72*H**3/D/D;if(!(D!==0&&Y>0&&!Number.isNaN(D))){C();return}const z=(le,N)=>le*N*(D*H-7.1397*H**2+25.08*H**3/D-37.43*H**4/D/D),q=[z(u.clientWidth,M[ee]),z(u.clientHeight,M[te])],B=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],J=[at(i.current[ee]-q[ee],p()?-B[ee]:0,B[ee]),at(i.current[te]-q[te],x()?-B[te]:0,B[te])],fe=J[ee]!==0||J[ee]!==B[ee],K=J[te]!==0||J[te]!==B[te];fe||K||C(),S&&(u.scrollLeft=J[ee]),v&&(u.scrollTop=J[te])};let E=!1;const w=b=>{if(E)return!0;const j=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],P=[Math.abs(a.current[dt]-b.pageX)>0,Math.abs(l.current[dt]-b.pageY)>0];return j[ee]&&P[ee]||j[te]&&P[te]},T=b=>{w(b)&&(E=!0,o(!0),a.current=[...a.current.slice(1),b.pageX],l.current=[...l.current.slice(1),b.pageY],c.current=[...c.current.slice(1),Date.now()],S&&(u.scrollLeft=f.current[ee]-(b.pageX-g.current[ee])),v&&(u.scrollTop=f.current[te]-(b.pageY-g.current[te])))},L=()=>{u.removeEventListener("mousemove",T),u.removeEventListener("mouseup",L),setTimeout(()=>{E=!1,o(!1)},0),i.current=[u.scrollLeft,u.scrollTop];const b=()=>{R(),h.current=requestAnimationFrame(b)};h.current=requestAnimationFrame(b)},_=b=>{b.button===0&&(b.preventDefault(),g.current=[b.pageX,b.pageY],f.current=[u.scrollLeft,u.scrollTop],a.current=[b.pageX,b.pageX,b.pageX],l.current=[b.pageY,b.pageY,b.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",T),u.addEventListener("mouseup",L),C())};return u.addEventListener("mousedown",_),u.addEventListener("wheel",C),()=>{u.removeEventListener("mousedown",_),u.removeEventListener("wheel",C),C()}},[e,r]),n},Fo=(e,r,n)=>{d.useEffect(()=>{if(e&&!n){r.pause();return}r.resume()},[e,r.isPaused,n])},Uo=(e,r,n,o,t)=>{d.useEffect(()=>{var l,c;const a=()=>{e&&r(!1),n&&o(!1)};return(l=t.current)==null||l.addEventListener("wheel",a),(c=t.current)==null||c.addEventListener("touchmove",a),()=>{var i,h;(i=t.current)==null||i.removeEventListener("wheel",a),(h=t.current)==null||h.removeEventListener("touchmove",a)}},[e,n])},Go=(e,r,n)=>{d.useEffect(()=>{if(e!==W.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};let o,t,a;const l=c=>{var f,u;if(a===!0)return;c.preventDefault();const i=!Math.abs(Math.abs(o!=null?o:c.deltaX)-Math.abs(c.deltaX)),h=!Math.abs(Math.abs(t!=null?t:c.deltaY)-Math.abs(c.deltaY));if(o=c.deltaX,t=c.deltaY,a||(a=!i||!h),a!==void 0){if(c.shiftKey){(f=n.current)==null||f.scrollBy({top:c.deltaY});return}(u=n.current)==null||u.scrollBy({left:r===it.LTR?c.deltaY:c.deltaY*-1})}};return n.current.addEventListener("wheel",l),()=>{var c;return(c=n.current)==null?void 0:c.removeEventListener("wheel",l)}},[e,r])},zo=e=>{const r=d.useRef(void 0);d.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},$o=(e,r,n,o,t)=>{d.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(Tr(t.current,n,o),0)},[e])},Xo=(e,r,n,o,t,a,l,c,i,h)=>{d.useLayoutEffect(()=>{if(e==null)return;const g=Ne(e,n);if(l){const p=e>r?wt.PREVIOUS:wt.NEXT,x=c.current[g.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:jr(p,i,h)})}const f=Te(g),u=f===o-1;t(null),a(f,!u,u)},[e])},Yo=(e,r,n,o,t,a,l)=>{const[c,i]=d.useState(l===W.DOUBLE_PAGE);d.useLayoutEffect(()=>{if(c&&l!==W.DOUBLE_PAGE){i(!1);const f=_s(n);o(f),t(f.map(({primary:{url:u}})=>({url:u,isSpread:!1})));return}l===W.DOUBLE_PAGE&&(c||a(Te(Ne(e,r))),o(r),i(l===W.DOUBLE_PAGE))},[r,l])},Ht=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=rt(),a=t.palette.getContrastText(Ar(t.palette,ys[o])),l=et(a,.5);return r?s.jsxs(I,{children:[s.jsx(Qe,{color:a,children:e}),s.jsx(Qe,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(Qe,{variant:"body2",color:l,children:n})]}):null},qo=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:l,currentChapterScanlator:c,previousChapterName:i,previousChapterScanlator:h,nextChapterName:g,nextChapterScanlator:f,scrollbarXSize:u,scrollbarYSize:p,readerNavBarWidth:x,handleBack:S})=>{var b;const{t:v}=G(),C=e===je.PREVIOUS,R=e===je.NEXT,E=!!l&&!i,w=!!l&&!g,T=E&&e===je.PREVIOUS,L=w&&e===je.NEXT;return!t&&!(T||L)||!wr(e,r,n)?null:s.jsx(I,{sx:{justifyContent:"center",alignItems:"center",...m(!Ve(n),{width:"100%",height:"100%"}),...m(Ve(n),{position:"sticky",...m(Ce(n),{left:0,maxWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),minHeight:"calc(100vh - ".concat(u,"px)")}),...m(n===W.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),maxHeight:"calc(100vh - ".concat(u,"px)")})})},children:s.jsxs(I,{sx:{gap:2,maxWidth:j=>"calc(100vw - ".concat(p,"px - ").concat(x,"px - ").concat(j.spacing(2),")"),maxHeight:"calc(100vh - ".concat(u,"px)"),width:"max-content",p:1},children:[C&&E&&s.jsx(Qe,{variant:"h6",children:v("reader.transition_page.first_chapter")}),s.jsxs(I,{sx:{gap:5},children:[C&&!E&&s.jsx(Ht,{title:v("reader.transition_page.previous"),name:i,scanlator:h,backgroundColor:o}),!!l&&s.jsx(Ht,{title:v(C?"reader.transition_page.current":"reader.transition_page.finished"),name:l,scanlator:c,backgroundColor:o}),R&&!w&&s.jsx(Ht,{title:v("reader.transition_page.next"),name:g,scanlator:f,backgroundColor:o})]}),R&&w&&s.jsx(Qe,{variant:"h6",children:v("reader.transition_page.last_chapter")}),(C&&E||R&&w)&&s.jsxs(I,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(tt,{sx:{flexGrow:1},onClick:j=>{j.stopPropagation(),S()},variant:"contained",children:v("reader.transition_page.exit.previous_page")}),s.jsx(tt,{sx:{flexGrow:1},component:Dt,onClick:j=>{j.stopPropagation()},variant:"contained",to:Xt.manga.path((b=a==null?void 0:a.id)!=null?b:-1),children:v("reader.transition_page.exit.manga_page")})]})]})})},ps=U(d.memo(qo),[We,({chapterId:e})=>{const{chapters:r}=He(),n=d.useMemo(()=>r.findIndex(l=>l.id===e),[e,r]),o=r[n],t=d.useMemo(()=>r[n+1],[n,r]),a=d.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},st,$e,we,O.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=Cr(),{chapters:o}=He(),t=d.useMemo(()=>o.findIndex(g=>g.id===e),[e,o]),a=t===0,l=t===o.length-1,c=r===je.PREVIOUS&&l,i=r===je.NEXT&&a;return{handleBack:c||i?n:ye}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),Ko=(e,r,n,o,t,a,l,c,i,h,g,f,u,p,x,S,v,C)=>{var E,w;const R=d.useRef(void 0);d.useLayoutEffect(()=>{var P;const T=(P=r.data)==null?void 0:P.fetchChapterPages;if(!T)return;const{pages:L}=T,_=L.length?L:[""],b=Or(n,o!=null?o:0,_.length-1),j=R.current!==(T==null?void 0:T.pages);if(j){R.current=T.pages;const M=_s(_);i(!0),f(M),u(_),p(M.map(({primary:{url:D}})=>({url:D,loaded:!1}))),x(M.map(({primary:{url:D}})=>({url:D,isSpread:!1})))}else f(t),p(a),x(l);g(T.pages.length),u(_),S(b),v(b),h(M=>({...M,isCurrentChapterReady:c||j})),C(je.NONE)},[(w=(E=r.data)==null?void 0:E.fetchChapterPages)==null?void 0:w.pages,e])},ms=0,St="-10px",Zo=(e,r,n)=>{if(!Ve(r))return;const o=Cs[n],t="0px ".concat(St," 0px 0px"),a="0px 0px 0px ".concat(St);return Ce(r)?e==="first"?"0px 0px ".concat(St," 0px"):"".concat(St," 0px 0px 0px"):e==="first"?ue(t,a,o):ue(a,t,o)},Jo=(e,r,n,o)=>e===it.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},Qo=(e,{top:r,right:n,bottom:o,left:t},a,l)=>{const c=window.innerWidth-l,i=window.innerHeight-a;return{[W.CONTINUOUS_VERTICAL]:{start:o>=i,end:r<0},[W.CONTINUOUS_HORIZONTAL]:Jo(e,t,n,c)}},ea=({[W.CONTINUOUS_VERTICAL]:e,[W.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e.start||e.end:r.start||r.end,ta=({[W.CONTINUOUS_VERTICAL]:e,[W.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e:r,vs=(e,r,n,o,t,a,l,c,i,h,g,f,u,p)=>{d.useEffect(()=>{const x=Ve(a),S=Ce(a);if(p||!u||!x||!c||!o||t||n===void 0)return()=>{};const v=()=>{const C=u.scrollLeft===0,R=u.scrollLeft===u.scrollWidth-u.clientWidth,E=u.scrollTop===0,w=u.scrollTop===u.scrollHeight-u.clientHeight;(e==="first"&&(S?E:C)||e==="last"&&(S?w:R))&&i(n,void 0,!1)};return u.addEventListener("scroll",v),()=>u.removeEventListener("scroll",v)},[a,u,p,c,o,t,n,i]),Lr(h,d.useCallback(x=>{if(!c||!Ve(a)||n===void 0||!p&&!t)return;const S=x[x.length-1],v=Qo(l,S.target.getBoundingClientRect(),g,f),{start:C,end:R}=ta(v,a),E=S.intersectionRatio<=ms;if(!ea(v,a))return;const w=e==="first"&&C&&!t,T=e==="last"&&!o&&R;if(w||e==="last"&&R&&E){i(n,!t,!1);return}T&&i(r,!1,!1)},[e,r,n,o,t,a,l,c,p,i,g,f]),d.useMemo(()=>({root:u,threshold:[ms],rootMargin:Zo(e,a,l),ignoreInitialObserve:!0}),[e,a,l]))},sa=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:l,isCurrentChapter:c,isNextChapterVisible:i,imageWrapper:h,openChapter:g,scrollbarXSize:f,scrollbarYSize:u,scrollElement:p,shouldShowTransitionPage:x})=>(vs("first",o,t,c,l,e,r,n,g,h,f,u,p,x),vs("last",o,a,c,i,e,r,n,g,h,f,u,p,x),null),ra=U(d.memo(sa),[()=>({openChapter:ge.useOpenChapter()}),O.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),na=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:l,transitionPageMode:c,retryFailedPagesKeyPrefix:i,setTransitionPageMode:h,readingMode:g,readerWidth:f,pageScaleMode:u,shouldOffsetDoubleSpreads:p,readingDirection:x,shouldUseInfiniteScroll:S,imagePreLoadAmount:v,pageGap:C,chapterId:R,previousChapterId:E,nextChapterId:w,isPreviousChapterVisible:T,isNextChapterVisible:L,lastPageRead:_,isInitialChapter:b,isCurrentChapter:j,isPreviousChapter:P,isNextChapter:M,isLeadingChapter:D,isTrailingChapter:H,isPreloadMode:Y,imageRefs:V,scrollIntoView:z,setReaderStateChapters:q,resumeMode:B,customFilter:J,shouldStretchPage:fe,scrollbarXSize:K,scrollbarYSize:Z,readerNavBarWidth:le,onSizeChange:N,minWidth:oe,minHeight:me,scrollElement:he})=>{const{t:ve}=G(),{direction:Re}=rt(),[xe,ae]=xt.useGetChapterPagesFetch(R!=null?R:-1),[re,Ae]=d.useState(!1),[pe,Fe]=d.useState(vt.totalPages),[Oe,Ue]=d.useState(vt.pageUrls),[Le,qe]=d.useState(vt.pages),[De,y]=d.useState(vt.pageLoadStates),[k,Ie]=d.useState(De.map(({url:A})=>({url:A,isSpread:!1}))),Ke=d.useRef(null),Be=d.useRef(j),ie=d.useRef(Le.map(()=>null)),Ze=d.useRef(null),ce=d.useMemo(()=>!!!pe||!(pe===k.length)?Le:g===W.DOUBLE_PAGE?Dr(Oe,k,p,x):Le,[k,g,p,x,pe]),X=d.useMemo(()=>Ir(g),[g]),nt=x===it.LTR,Pe=Ve(g),_e=!Pe&&!j||Y,Ge=!Pe&&j,_t=!_e&&(Ge||Pe&&(b||D)),yt=!_e&&(Ge||Pe&&(b||H));Be.current=j,j&&(V.current=ie.current);const Je=d.useCallback(()=>{R&&(Ae(!1),xe({variables:{input:{chapterId:R}}}).catch(bt()))},[xe,R]),ct=d.useMemo(()=>Br(ce,Ie,A=>{Be.current&&n(A),y(A)},g),[ce,g]),kt=d.useMemo(()=>Pr(A=>{Be.current&&n(A),y(A)}),[]);d.useEffect(()=>{Je()},[R]),Ye(Ke,d.useCallback(A=>{const{clientWidth:Ee,clientHeight:ot}=A[0].target;N(Ee,ot,R)},[N,Ke.current,R]));const de=(A,Ee,ot,mt=!1)=>{(mt||!re)&&Ee(A),j&&ot(A)};return Ko(j,ae,B,_,ce,De,k,re,Ae,A=>de(A,ye,q),A=>de(A,Fe,o),A=>de(A,qe,r),A=>de(A,Ue,ye),A=>de(A,y,n),A=>de(A,Ie,ye),A=>de(A,ye,t),A=>{(b&&!re||z)&&(l(A),q(Ee=>({...Ee,visibleChapters:{...Ee.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},A=>de(A,ye,h)),Yo(e,ce,Oe,A=>de(A,qe,r,!0),A=>de(A,Ie,ye,!0),A=>de(A,ye,a),g),Pe||j||P||M?ae.error?_e?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(At,{message:ve("global.error.label.failed_to_load_data"),messageExtra:ks(ae.error),retry:()=>{Je()}})}):ae.loading||!re?_e?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(It,{})}):R!=null&&!pe?_e?null:s.jsx($,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(At,{message:ve("reader.error.label.no_pages_found"),retry:Je})}):s.jsxs(I,{ref:Ke,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(g===W.CONTINUOUS_HORIZONTAL,{minHeight:me}),...m(Ce(g),{minWidth:oe}),...m(_e,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(Ce(g)&&Ns(f,u),{alignItems:"center"}),...m(g===W.CONTINUOUS_HORIZONTAL,{...m(Re==="ltr",{flexDirection:nt?"row":"row-reverse"}),...m(Re==="rtl",{flexDirection:nt?"row-reverse":"row"})})},children:[!Y&&s.jsx(ra,{readingMode:g,readingDirection:x,shouldUseInfiniteScroll:S,chapterId:R,previousChapterId:E,nextChapterId:w,isCurrentChapter:j,isPreviousChapterVisible:T,isNextChapterVisible:L,imageWrapper:Ze.current,scrollbarXSize:K,scrollbarYSize:Z,scrollElement:he}),_t&&s.jsx(ps,{chapterId:R,type:je.PREVIOUS}),s.jsx(X,{ref:Ze,totalPages:pe,currentPageIndex:e,pages:ce,transitionPageMode:c,pageLoadStates:De,retryFailedPagesKeyPrefix:i,imageRefs:ie,onLoad:ct,onError:kt,isCurrentChapter:j,isPreviousChapter:P,isNextChapter:M,readingMode:g,imagePreLoadAmount:v,readingDirection:x,pageScaleMode:u,pageGap:C,customFilter:J,shouldStretchPage:fe,readerWidth:f,scrollbarXSize:K,scrollbarYSize:Z,readerNavBarWidth:le,isPreloadMode:Y,resumeMode:B,handleAsInitialRender:z}),yt&&s.jsx(ps,{chapterId:R,type:je.NEXT})]}):null},oa=d.memo(na),aa=(e,r,n,o)=>{const t=_r(r),a=yr(r),l=n!==window.innerWidth,c=o!==window.innerHeight,i=t&&l,h=a&&c;return!Ce(e)&&l?!0:i||h},Rs=(e,r,n)=>{d.useLayoutEffect(()=>{n(r)},[e])},ia=(e,r,n,o)=>{const t=d.useRef({width:window.innerWidth,height:window.innerHeight}),a=d.useCallback(()=>{const{width:l,height:c}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},aa(e,r,l,c)&&n(o)},[e,r,o]);Sn("resize",a)},Ks=e=>{const r=d.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,l;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(l=t==null?void 0:t.offsetTop)!=null?l:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(l,c)=>Array.from(l).filter(i=>i instanceof HTMLElement).flatMap(i=>i instanceof HTMLImageElement?[i]:Array.from(i.querySelectorAll("img"))).forEach(c),t=new IntersectionObserver(l=>{const c=l.find(i=>i.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),a=new MutationObserver(l=>{for(const c of l)o(c.addedNodes,i=>t.observe(i)),o(c.removedNodes,i=>t.unobserve(i))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},ca=(e,r)=>{const n=Ks(e),o=Ve(r),t=Ce(r);d.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const l=g=>{const{left:f,top:u,visibleElement:p,visibleElementLeft:x,visibleElementTop:S}=n.current;if(!p||!!!g.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:t?w.target.offsetTop<u:Math.abs(w.target.offsetLeft)<Math.abs(f)).length)return;const R=f-x+p.offsetLeft,E=u-S+p.offsetTop;a.scrollTo(R,E)},c=(g,f)=>Array.from(g).filter(u=>u instanceof HTMLElement).flatMap(u=>u instanceof HTMLImageElement?[u]:Array.from(u.querySelectorAll("img"))).forEach(f),i=new ResizeObserver(l),h=new MutationObserver(g=>{for(const f of g)c(f.addedNodes,u=>i.observe(u)),c(f.removedNodes,u=>i.unobserve(u))});return h.observe(a,{childList:!0,subtree:!0}),()=>{h.disconnect(),i.disconnect()}},[o,t])},la=(e,r,n,o,t,a,l)=>{const c=Ks(e),i=()=>{const h=e.current,{left:g,top:f,visibleElementLeft:u,visibleElementTop:p,visibleElement:x}=c.current;if(!h||!l||!x)return!1;const S=Ms(n,t,a),v=o===0;if(!(!S.previous&&v))return!1;const R=g-u+x.offsetLeft,E=f-p+x.offsetTop;return h.scrollTo(R,E),!0};d.useEffect(()=>{const h=e.current;if(!h||!l)return()=>{};let g=!1;const f=(x,S)=>{Array.from(x).filter(v=>v instanceof HTMLElement).flatMap(v=>v instanceof HTMLImageElement?[v]:Array.from(v.querySelectorAll("img"))).forEach(S)},u=new ResizeObserver(()=>{g||(g=i(),g&&u.disconnect())}),p=new MutationObserver(x=>{for(const S of x)f(S.addedNodes,v=>u.observe(v)),f(S.removedNodes,v=>u.unobserve(v))});return p.observe(h,{childList:!0,subtree:!0}),()=>{p.disconnect(),u.disconnect()}},[r]),d.useLayoutEffect(()=>{i()},[r])},da=(e,r,n,o,t,a,l,c,i,h)=>{la(e,r,n,o,t,a,Ve(l)),ca(e,l),ia(l,h,i,o),Rs(c,o,i),Rs(l,o,i)},ua={[W.SINGLE_PAGE]:lt.X,[W.DOUBLE_PAGE]:lt.X,[W.CONTINUOUS_VERTICAL]:lt.Y,[W.CONTINUOUS_HORIZONTAL]:lt.X,[W.WEBTOON]:lt.Y},ga=d.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,transitionPageMode:h,retryFailedPagesKeyPrefix:g,setTransitionPageMode:f,readingMode:u,readingDirection:p,shouldUseInfiniteScroll:x,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:R,pageGap:E,customFilter:w,shouldStretchPage:T,isStaticNav:L,readerNavBarWidth:_,setScrollbarXSize:b,setScrollbarYSize:j,isVisible:P,setIsVisible:M,updateCurrentPageIndex:D,showPreview:H,setShowPreview:Y,initialChapter:V,currentChapter:z,chapters:q,visibleChapters:B,setReaderStateChapters:J,isCurrentChapterReady:fe},K)=>{var Be;const{direction:Z}=rt(),{resumeMode:le=ns.START}=(Be=Hs().state)!=null?Be:{resumeMode:ns.START},N=d.useRef(null),oe=bn(K,N),me=Ce(u),he=Ve(u),ve=Wo(N),Re=pt();d.useEffect(()=>Re.setScrollRef(N),[]);const xe=os.useGetScrollbarSize("width",N.current),ae=os.useGetScrollbarSize("height",N.current);d.useLayoutEffect(()=>{b(xe),j(ae)},[xe,ae]);const re=ge.useHandleClick(N.current),Ae=d.useRef(o.map(()=>null)),[{minChapterViewWidth:pe,minChapterViewHeight:Fe,minChapterSizeSourceChapterId:Oe},Ue]=d.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,Le]=d.useState({}),qe=ua[u],De=p===it.LTR,y=d.useMemo(()=>q.findIndex(ie=>ie.id===(V==null?void 0:V.id)),[q,V==null?void 0:V.id]),k=d.useMemo(()=>q.slice(Math.max(0,y-B.trailing),Math.min(q.length,y+B.leading+1)),[q,y,B.trailing,B.leading]),Ie=d.useMemo(()=>k.findIndex(ie=>ie.id===(z==null?void 0:z.id)),[z,k]),Ke=d.useCallback((ie,Ze,ce)=>{if(!he)return;const X=ce===Oe;if(me){if(!X&&pe>=ie)return;Ue({minChapterViewWidth:ie,minChapterViewHeight:0,minChapterSizeSourceChapterId:ce});return}(X||Fe<Ze)&&Ue({minChapterViewWidth:0,minChapterViewHeight:Ze,minChapterSizeSourceChapterId:ce})},[he,me,pe,Fe,Oe]);if(Xo(r,e,o,t,n,D,he,Ae,Z,p),$o(e,he,Z,p,N),zo(N),Go(u,p,N),Uo(P,M,H,Y,N),Fo(P,Re,L),da(N,z==null?void 0:z.id,Ie,e,k,B,u,p,n,v),d.useLayoutEffect(()=>{Ue({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),Le({})},[u]),!V||!z)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(I,{ref:oe,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(me&&Ns(S,v),{alignItems:"center"}),...m(!me,{...m(Z==="ltr",{flexDirection:De?"row":"row-reverse"}),...m(Z==="rtl",{flexDirection:De?"row-reverse":"row"})})},onClick:ie=>!ve&&re(ie),onScroll:()=>ge.updateCurrentPageOnScroll(Ae,t-1,D,qe,p),children:k.map((ie,Ze)=>{var ot,mt,Zt,Jt;const ce=Math.max(0,k.length-Ze-1),X=k[ce],nt=(ot=k[ce+1])!=null?ot:q[y+B.leading+1],Pe=(mt=k[ce-1])!=null?mt:q[y-B.trailing-1],_e=X.id===V.id,Ge=X.id===z.id,_t=X.id===((Zt=k[Ie+1])==null?void 0:Zt.id),yt=X.id===((Jt=k[Ie-1])==null?void 0:Jt.id),Je=V.sourceOrder>X.sourceOrder,ct=V.sourceOrder<X.sourceOrder,kt=B.lastLeadingChapterSourceOrder===X.sourceOrder,de=B.lastTrailingChapterSourceOrder===X.sourceOrder,Kt=kt&&B.isLeadingChapterPreloadMode||de&&B.isTrailingChapterPreloadMode,A=Ms(ce,k,B),Ee=X.id===Oe;return s.jsx(oa,{chapterId:X.id,previousChapterId:nt==null?void 0:nt.id,nextChapterId:Pe==null?void 0:Pe.id,isPreviousChapterVisible:A.previous,isNextChapterVisible:A.next,lastPageRead:at(X.lastPageRead,0,X.pageCount-1),currentPageIndex:Nr(e,X,z,Ge,fe,Je,ct,B),isInitialChapter:_e,isCurrentChapter:Ge,isPreviousChapter:_t,isNextChapter:yt,isLeadingChapter:Je,isTrailingChapter:ct,isPreloadMode:Kt,imageRefs:Ae,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,setPageToScrollToIndex:n,transitionPageMode:h,retryFailedPagesKeyPrefix:g,readingMode:u,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,readingDirection:p,shouldUseInfiniteScroll:x,updateCurrentPageIndex:Ge?D:ye,scrollIntoView:Ge&&B.scrollIntoView,resumeMode:kr(Ge,_e,Je,ct,B.resumeMode,le),setReaderStateChapters:J,setTransitionPageMode:f,pageGap:E,imagePreLoadAmount:R,customFilter:w,shouldStretchPage:T,scrollbarXSize:xe,scrollbarYSize:ae,readerNavBarWidth:_,onSizeChange:Ke,minWidth:Ee?0:pe,minHeight:Ee?0:Fe,scrollElement:N.current},X.id)})})}),fa=U(d.memo(ga),[we,O.useSettingsWithoutDefaultFlag,st,Bt,()=>({updateCurrentPageIndex:ge.useUpdateCurrentPageIndex()}),Pt,He,$e],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","isStaticNav","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),ha=Object.fromEntries(Object.values(ht).map(e=>[e,{scopes:e}])),se=(...e)=>{const[r,n,o,t]=e;return Mr(r,n,{...o,...ha.reader},t)},Vt=(e,r,n,o,t,a,l)=>{if(a){e(n,t[0]);return}const c=$s(t.indexOf(o),t,l);if(c===void 0){r(n);return}e(n,c)},xa=({scrollElementRef:e})=>{const{direction:r}=rt(),n=O.useGetThemeDirection(),{enableScope:o,disableScope:t}=bs(),{manga:a}=We(),{isVisible:l,setIsVisible:c}=Bt(),{hotkeys:i,pageScaleMode:h,shouldStretchPage:g,shouldOffsetDoubleSpreads:f,readingMode:u,readingDirection:p,autoScroll:x,scrollAmount:S}=O.useSettings(),v=pt(),{setShowPreview:C}=Pt(),R=O.useExit(),E=ge.useOpenChapter(),w=ge.useOpenPage(),T=O.useCreateUpdateSetting(a!=null?a:Me),L=O.useCreateDeleteSetting(a!=null?a:Me);return se(i[Q.PREVIOUS_PAGE],()=>w("previous"),[w]),se(i[Q.NEXT_PAGE],()=>w("next"),[w]),se(i[Q.SCROLL_BACKWARD],()=>{if(v.isActive){v.setDirection(Rt.BACKWARD);return}e.current&&ge.scroll(Rt.BACKWARD,as[u.value],u.value,p.value,r,e.current,E,c,C,S)},{preventDefault:!0},[u.value,p.value,r,E,S,v.isActive]),se(i[Q.SCROLL_FORWARD],()=>{if(v.isActive){v.setDirection(Rt.FORWARD);return}e.current&&ge.scroll(Rt.FORWARD,as[u.value],u.value,p.value,r,e.current,E,c,C,S)},{preventDefault:!0},[u.value,p.value,r,E,S,v.isActive]),se(i[Q.PREVIOUS_CHAPTER],()=>E(ue("previous","next",n)),[E,n]),se(i[Q.NEXT_CHAPTER],()=>E(ue("next","previous",n)),[E,n]),se(i[Q.TOGGLE_MENU],()=>c(!l),[l]),se(i[Q.CYCLE_SCALE_TYPE],()=>{Vt(T,L,"pageScaleMode",h.value,Os,h.isDefault,!0)},[T,L,h.value,h.isDefault]),se(i[Q.STRETCH_IMAGE],()=>T("shouldStretchPage",!g.value),[T,g.value]),se(i[Q.OFFSET_SPREAD_PAGES],()=>T("shouldOffsetDoubleSpreads",!f.value),[T,f.value]),se(i[Q.CYCLE_READING_MODE],()=>{Vt(T,L,"readingMode",u.value,Ls,u.isDefault,!0)},[T,L,u.value,u.isDefault]),se(i[Q.CYCLE_READING_DIRECTION],()=>{Vt(T,L,"readingDirection",p.value,Ds,p.isDefault,!0)},[T,L,p.value,p.isDefault]),se(i[Q.TOGGLE_AUTO_SCROLL],v.toggleActive,{preventDefault:!0},[v.toggleActive]),se(i[Q.AUTO_SCROLL_SPEED_DECREASE],()=>T("autoScroll",{...x,value:Math.min(ke.max,x.value+ke.step)}),[T,x.value]),se(i[Q.AUTO_SCROLL_SPEED_INCREASE],()=>T("autoScroll",{...x,value:Math.max(ke.min,x.value-ke.step)}),[T,x.value]),se(i[Q.EXIT_READER],R,[R]),d.useEffect(()=>(o(ht.READER),()=>t(ht.READER)),[]),null},pa=(e,r,n,o,t,a,l,c,i,h,g,f)=>{d.useEffect(()=>()=>{e(void 0),r(Et),n(0),o(null),t(0),a([Hr("",0)]),l([]),c([{url:"",loaded:!1}]),i(je.NONE),h(!1),g(Vr),f()},[])},ma=(e,r,n,o,t,a)=>{var l;d.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||r.loading||r.error)return;const i=is(c,n),h=Wr(c,i.shouldUseAutoWebtoonMode,i.readingMode),g={...n,readingMode:h?W.WEBTOON:n.readingMode},f=h?W.WEBTOON:i.readingMode.value,u=Fr("global",{meta:o},g,void 0,f),p=is(c,u);t(p),a(!0)},[(l=e.data)==null?void 0:l.manga,n])},Ss=5e3,va=(e,r,n,o,t,a,l,c,i)=>{const{t:h}=G(),g=d.useRef(void 0),f=d.useRef(void 0),u=d.useRef(void 0),p=d.useRef(!0);d.useEffect(()=>{if(e||r||!n)return;const x=JSON.stringify(o)!==JSON.stringify(g.current);l&&x&&Ps(h(Gt[o.value].title),{autoHideDuration:Ss}),g.current=o;const v=JSON.stringify(t)!==JSON.stringify(f.current)||JSON.stringify(a)!==JSON.stringify(u.current);c&&v&&(i(!0),p.current&&setTimeout(()=>i(!1),Ss)),f.current=t,u.current=a,p.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},Ra=(e,r,n,o,t,a,l,c,i)=>{var p;const h=Ur(),g=Hs().state,{updateInitialChapter:f}=g!=null?g:{},u=f?void 0:o;d.useEffect(()=>{var L,_;const x=(L=e.data)==null?void 0:L.chapters.nodes,S=x?(_=x[x.length-r])!=null?_:null:void 0,v=u!=null?u:S,C=t!=null?t:S,R=(()=>{if(!x||!C)return[];const b=c?cn(n!=null?n:x,i):x;return(l?ze.removeDuplicates(C,b):b).map(P=>Gr(P.id))})(),E=S&&ze.getNextChapter(S,R,{offset:wt.NEXT}),w=S&&ze.getNextChapter(S,R,{offset:wt.PREVIOUS}),T=v!=null&&v.id!==(u==null?void 0:u.id);T&&h("",{replace:!0,state:{...g,updateInitialChapter:void 0}}),a(b=>{var P,M,D,H;const j=(S==null?void 0:S.id)!==((P=b.currentChapter)==null?void 0:P.id);return{...b,mangaChapters:(M=b.mangaChapters)!=null?M:x,chapters:R,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:S,nextChapter:E,previousChapter:w,isCurrentChapterReady:j?!1:b.isCurrentChapterReady,visibleChapters:T?{...Et.visibleChapters,lastLeadingChapterSourceOrder:(D=v==null?void 0:v.sourceOrder)!=null?D:Et.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(H=v==null?void 0:v.sourceOrder)!=null?H:Et.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!b.initialChapter}:b.visibleChapters}})},[(p=e.data)==null?void 0:p.chapters.nodes,r,l,c,u,i])},Sa=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:l,shouldSkipFilteredChapters:c,backgroundColor:i,readingMode:h,tapZoneLayout:g,tapZoneInvertMode:f,shouldShowReadingModePreview:u,shouldShowTapZoneLayoutPreview:p,setSettings:x,mangaChapters:S,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:R,setReaderStateChapters:E,setTotalPages:w,setCurrentPageIndex:T,setPageToScrollToIndex:L,setPages:_,setPageUrls:b,setPageLoadStates:j,setTransitionPageMode:P,cancelAutoScroll:M,setShowPreview:D})=>{var Re,xe,ae;const{t:H}=G(),Y=d.useRef(null),[V,z]=d.useState(!1),{chapterSourceOrder:q,mangaId:B}=$r(),J=Number(q),fe=Number(B),K=xt.useGetManga(Xr,fe),Z=xt.useGetMangaChapters(Yr,fe);En(!t||!R?H("reader.title",{mangaId:fe,chapterIndex:J}):"".concat(t.title,": ").concat(R.name));const{metadata:le,settings:N,request:oe}=qr(),me=ln(t!=null?t:Me),he=R===void 0||!V||K.loading||Z.loading||oe.loading,ve=(xe=(Re=K.error)!=null?Re:Z.error)!=null?xe:oe.error;return d.useEffect(()=>{var re;a((re=K.data)==null?void 0:re.manga)},[(ae=K.data)==null?void 0:ae.manga]),pa(a,E,T,L,w,_,b,j,P,o,x,M),ma(K,oe,N,le,x,z),va(he,ve,V,h,g,f,u,p,D),Ra(Z,J,S,v,C,E,l,c,me),d.useLayoutEffect(()=>(e({status:!0,value:s.jsxs($,{sx:{position:"absolute"},children:[s.jsx(xa,{scrollElementRef:Y}),s.jsx(ko,{isVisible:n}),!Y.current&&s.jsx($,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,Y.current]),ve?s.jsx(At,{message:H("global.error.label.failed_to_load_data"),messageExtra:ks(ve),retry:()=>{K.error&&K.refetch().catch(bt()),oe.error&&oe.refetch().catch(bt()),Z.error&&Z.refetch().catch(bt())}}):he?s.jsx($,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(It,{})}):R===null?s.jsx(At,{message:H("reader.error.label.chapter_not_found")}):!t||!R?null:s.jsxs($,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:re=>"width 0.".concat(re.transitions.duration.shortest,"s, margin-left 0.").concat(re.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:ys[i]},children:[s.jsx(fa,{ref:Y}),s.jsx(Mo,{}),s.jsx(Vo,{})]})},ei=U(d.memo(Sa),[$e,Bt,We,He,zr,()=>{const{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}=O.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=O.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},we,()=>({cancelAutoScroll:pt().cancel}),Pt],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","shouldSkipFilteredChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","mangaChapters","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{ei as Reader};
